# 本周安全:莫尔斯电码恶意软件，字面和比喻水坑，以及更多

> 原文：<https://hackaday.com/2021/02/12/this-week-in-security-morse-code-malware-literal-and-figurative-watering-holes-and-more/>

代码混淆已经存在很长时间了。混淆 C 语言竞赛最早可以追溯到 1984 年，但是在更早的历史上就有自然语言混淆的例子。也就是伦敦腔押韵俚语，比如说“来自布里斯托尔的女士”而不是“手枪”，或者“一块铅”而不是“头”。据推测，伦敦腔最初是用来让罪犯阶层在不向警察通风报信的情况下进行交谈的。

恶意软件中的代码混淆服务于类似的目的——隐藏安全设备和应用程序。反恶意软件扫描已知的代码片段和黑名单中的 IP 地址。如果已知的坏代码可以成功混淆，它可以避免检测。这有点像一场持续的猫捉老鼠的游戏，因为去模糊代码本身最终会进入黑名单。这导致了新的混淆技术，有时相当古怪。本周，我发现了一个非常奇怪的方法。[莫尔斯电码](https://www.bleepingcomputer.com/news/security/new-phishing-attack-uses-morse-code-to-hide-malicious-urls/)。

是的，点和破折号。整个攻击是这样的。你收到一封声称是发票的邮件。这是一个`.xlsx.hTML`文件。如果你没有注意到奇怪的文件扩展名，并让它打开，你会看到一个网页。该页面的源代码是一个非常简单的 JS 脚本，由一个莫尔斯码解码器和一个用莫尔斯编码的有效载荷组成。在这种情况下，有效负载只是一对要求 Office 365 登录的外部脚本。这方面的新颖之处肯定是莫尔斯电码。是的，[我们自己的【Danie】在本周早些时候报道了这个](https://hackaday.com/2021/02/11/phishing-with-morse-code/)，但是在这里不提及是太好了。

### 字面上的水坑攻击

你可能已经看过令人窒息的新闻报道，一次网络生物恐怖袭击几乎毒害了一座城市。来说说实际发生的事情吧。这个城市的人口不到 15，000，有一个专用的供水系统。处理厂的主控制计算机上安装了一个远程访问程序。一名未经授权的用户在当天早些时候从外部使用了该远程访问程序，但只连接了一会儿。第一次访问被认为是对远程访问系统的合法使用，但是当天晚些时候，很明显有些事情正在发生。当第二次访问系统时，远程用户调高了氢氧化钠的浓度，大概是调到最大值，然后退出登录。

原来，有问题的 Windows 7 电脑运行的是 TeamViewer，全市所有电脑共用一个密码。克里斯托弗·克雷布斯(Christopher Krebs)认为，一个被责骂的员工可能会受到责备，这是一个不错的猜测。

### 隐喻水坑攻击

这些标题写自己，但这个水坑攻击有相当大的转折。我们已经报道了类似平台`pip`和`npm`上的域名仿冒和恶意项目接管等问题。[Alex Birsan]提出了一个相关的攻击，他称之为“[依赖性混乱](https://medium.com/@alex.birsan/dependency-confusion-4a5d60fec610)”。灵感来自于找到不打算在 Github 上公开发布的 PayPal 代码。这段代码引起他兴趣的是依赖项列表，其中一些是`npm`上的开源包，而一些显然是专有包。这种混合让我想到一个问题。如果上传到`npm`的包与本地包有名称冲突，会使用哪个版本？

作为一名有事业心的研究人员，[亚历克斯]决定找出答案。他确实提出了重要的警告，即他有权对他的所有目标进行现场渗透测试，无论是通过公共奖金计划的条款，还是通过私人协议。没有授权，试图实施这样的攻击会让你陷入严重的困境。

那么，当构建系统请求一个既存在于本地又存在于公共存储库中的包时，会发生什么呢？视情况而定，但在许多情况下，会使用版本号更高的包。[Alex]从他能找到的每一个来源收集关于专有包名称的信息，并精心制作概念验证包。为了收集成功列表，欺骗包通过 DNS 请求泄漏了几个字节的编码数据。易受攻击的公司名单令人印象深刻，支付的金额也是如此。苹果、Paypal 和 Shopify 都证实了这项技术的有效性，并分别支付了 3 万美元的奖金。有时候做一个安全研究员是非常好的。

### 你所有的条形码都属于我们

条形码扫描仪成为流行的手机应用程序并不奇怪。你有一台带摄像头和互联网连接的掌上电脑。指向条形码并获得关于产品的即时信息具有潜在的无价价值。Android 上非常受欢迎的条形码扫描仪应用程序之一，安装量超过 1000 万，最近[开始了一场非常积极的广告软件活动](https://blog.malwarebytes.com/android/2021/02/barcode-scanner-app-on-google-play-infects-10-million-users-with-one-update/)。该应用程序的发行商是 LavaBird 有限公司。

一旦不良行为被注意到，该应用程序就会被从 play store 下架。这不会将它从设备中删除，因此您可以检查您的设备是否有 LavaBird 软件。Malwarebytes 博客指出，有时像这样的恶意活动是第三方广告库的结果，而不是应用程序开发者的过错。在这种情况下，坏代码直接在应用程序本身中，由开发人员的密钥签名，并被混淆以难以检测。总的来说，这种情况让人想起我们上周报道的吊杆大崩溃。这让我怀疑类似的事情发生过。很可能，最初的应用程序作者卖给了一个可疑的第三方，后者在应用程序中填充了恶意软件。

### 值得注意的事项

Firefox [在大约一周前](https://www.mozilla.org/en-US/firefox/85.0.1/releasenotes/)发布了 85.0.1，在变更日志中有一个有趣的注释:“阻止访问可能导致文件系统损坏的 NTFS 特殊路径。”这份相当隐晦的说明是对 [bug 1689598](https://bugzilla.mozilla.org/show_bug.cgi?id=1689598) 的引用，在撰写本文时该 bug 仍然受到限制。我们可以看看修复了问题的变更日志。显然，有一种方法可以在打开文件时调用一个特殊的文件处理程序，如`$MFT`或`$Volume`。恶意调用可能导致文件系统损坏，因此可能会导致严重的拒绝服务攻击。

还记得几周前的那个`sudoedit` bug 吗？一些厂商，即苹果，认为他们对这个错误免疫，因为他们没有`sudoedit`符号链接。[没过多久，互联网就发现](https://www.zdnet.com/article/recent-root-giving-sudo-bug-also-impacts-macos/)自己创建符号链接很简单，然后触发 bug。

谷歌似乎已经兑现了他们的“了解、预防、修复”倡议，发布了开源漏洞数据库。目前，[OSS- Fuzz 项目](https://github.com/google/oss-fuzz)是唯一的数据来源，但更多的计划中。其目的似乎是为追踪漏洞提供一个自动化的数据源。时间将会告诉我们 KPF 计划将会带来什么样的新工具。