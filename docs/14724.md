# 特斯拉的 Dojo 是一个有趣的 CPU 设计

> 原文:[https://hack aday . com/2022/09/06/tes las-Dojo-is-an-interest-CPU-design/](https://hackaday.com/2022/09/06/teslas-dojo-is-an-interesting-cpu-design/)

当您将现代的超标量无序 CPU 内核与更传统的微控制器(如无虚拟内存、无内存缓存、无 DDR 或 PCIe 控制器)相结合时，您会得到什么？你得到了泰斯拉道场，薯条和奶酪最近对它进行了一次深度研究。

它从与 IBM Cell 处理器的比较开始。2000 年代中期的单元具有被称为 SPE(协同处理元件)的特征。它们是较小的内核，专注于矢量处理或其他专门类型的工作负载。他们不访问主内存，必须由功能齐全的 CPU 来分配任务。Dojo 有 1.25MB 的 SRAM，它可以使用五个端口作为工作内存，但它没有缓存或虚拟内存。它使用 DMA 通过网状系统获取所需的信息。前端将类似 RISC-V(主要受 MIPS 启发)的指令拉入一个小型指令缓存，每个周期解码八条指令。

有趣的是，前端积极地删除指令，如跳转或条件。然而，被消除的指令不会通过流水线被跟踪。指令不通过退役来跟踪，所以在异常和调试期间，不清楚出错的指令是什么，因为指令是无序退役的。

尽管前端很宽，但只有两个 alu 和两个 agu。这是有意义的，因为整数执行的焦点主要集中在控制流和逻辑上。真正的计算能力是向量和矩阵执行管道。凭借 512 位向量和 8x8x4 矩阵，每个 dojo 内核都接近完整的 BF16 TFLOP。其结果是，它看起来更像一个微处理器，但却像现代桌面 CPU 一样宽。

所有这些决定可能看起来很奇怪，直到你退后一步，看看特斯拉试图实现的目标。他们寻求尽可能小的内核，以便在芯片上安装尽可能多的内核。没有缓存，您就不需要内存中的任何监听过滤器或标记来保持一致性。在 TSMC 的 7 纳米工艺中，Dojo 内核和 SRAM 的尺寸只有 1.1 平方毫米。超过 71.1%的芯片花费在内核和 SRAM 上(相比之下，AMD Zeppelin 的这一比例为 56%)。一个 Dojo D1 骰子有 354 个 Dojo 内核。可以想象，Dojo 骰子必须与接口处理器通信，接口处理器通过 PCIe 连接到主机。然而，Dojo 部署通常有 25 个芯片，这使得它成为一台非常可扩展的超级计算机。

如果你对剥离更多的计算核心层感到好奇，那么[去看看阿尔德湖](https://hackaday.com/2021/12/29/peering-into-the-murky-depths-of-alder-lake/)。