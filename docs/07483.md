# 弗朗西斯·艾伦在你不知情的情况下优化了你的代码

> 原文:[https://hack aday . com/2020/08/25/frances-Allen-optimized-your-code-without you-even-knowledge/](https://hackaday.com/2020/08/25/frances-allen-optimised-your-code-without-you-even-knowing/)

在 2020 年，我们的数字世界和我们用来创建它的软件是一个高耸的结构，建立在无数层抽象和构建块之上——想想加载网页时发生的所有翻译和交互。虽然抽象无疑是一件伟大的事情，但它只有在我们建立在坚实的基础上时才起作用；如果下层稳定快速。这在实践中意味着什么？它意味着低级的编译语言，可以被大量优化和利用来充分利用计算机硬件。这一领域的巨人之一是弗朗西斯·艾伦，她最近于 8 月初去世。被 IBM 描述为“编译器组织和优化算法的先驱”，她在该领域做出了许多重大贡献。

## 早期

![](../Images/c56a1007e93ea59915feb31e55aaf9c6.png)

Via [Wikimedia](https://commons.wikimedia.org/wiki/File:Allen_mg_2545-b.jpg)

艾伦是一名数学教师，毕业后在纽约的一所高中工作了两年。她回去完成了数学硕士学位，并被校园内的 IBM 研究院录用。尽管她计划待的时间只够还清债务并迅速重返教学岗位，但她发现自己在职业生涯的剩余时间都在 IBM 工作，甚至在 1989 年成为了 IBM 的第一位女性研究员。

Allen 在 IBM 的第一份工作是教内部工程师和科学家如何使用 FORTRAN——显然，对于当时习惯于汇编编程的人来说，这很难接受，因为汇编编程做得很好。非常感谢。在一次采访中，艾伦谈到了来自科学家的抵制，他们认为编译语言不可能产生足够好的代码。

![](../Images/8740c373a57f05eec9d07adb8643b4a9.png)

The Stretch supercomputer (via [IBM](https://www-03.ibm.com/press/us/en/photo/25084.wss))

教学结束后，艾伦开始为一台名为 Stretch 的 100 千瓦“超级计算机”开发编译器。凭借 2048 kB 的内存，Stretch 的目标是比当时可用的任何其他系统快 100 倍。虽然这最终失败了(令一些客户沮丧的是，一个发现项目花了 18 个小时来制作他们的 24 小时天气预报)，但它引起了美国国家安全局的注意。

正因为如此，IBM 设计了一个协处理器插件 Harvest，专门用于 NSA 的密码破解。Harvest 最终比 Stretch 本身更大，Allen 花了一年时间领导 NSA 内部的一个团队，从事高度机密的项目。直到他们的工作被泄露给媒体，这个团队才发现他们正在做的许多事情(这是对苏联的间谍活动——猜也猜不到)。

![](../Images/666c8018db3e7bf1f791a5e6f6684617.png)

Engineers with Tractor tapes for Harvest

作为一项工程壮举，Harvest 使用了一种独特的流架构来破解代码:加载到 IBM [牵引带](https://en.wikipedia.org/wiki/IBM_7950_Harvest)上的信息被连续不断地输入内存，实时处理和输出，IO 和操作完全同步。Harvest 每秒可以处理 300 万个字符，据美国国家安全局估计，它的速度比其他商业产品快 50-200 倍。该项目非常成功，安装后使用了 14 年，考虑到当时的技术进步速度，这是一个令人印象深刻的壮举。

## 速度是最重要的

该项目的成功在很大程度上要归功于 Allen 对编译器进行的优化工作。编译器优化是神奇的。我们中的一些人认为编译器是简单的“源代码输入，机器码输出”的盒子，但它们的复杂性在于它们用来确保代码尽可能快速运行的完全自动化的优化套件和中间步骤。当然，这对于当时有限的硬件来说很重要，但是 Allen 帮助开发的技术在现代编译器中随处可见。《纽约时报》援引 gray don Hoare(Rust 的创造者，当今最著名的编译器专家之一)的话说，Allen 的工作存在于“每个应用程序、每个网站、每个视频游戏或通信系统、每个政府或银行计算机、汽车或飞机上的每个机载计算机”。

[![](../Images/84543875ab3288c86b204a8811ac91e1.png)](https://hackaday.com/wp-content/uploads/2020/08/frances-allen-optimization-diagram.jpg) 那么编译器优化实际上是什么样子的呢？艾伦在这个主题上写了许多有影响力的论文，但她在 1972 年与约翰·科克合著的[“优化转换目录”](https://www.clear.rice.edu/comp512/Lectures/Papers/1971-allen-catalog.pdf)尤其具有开创性。它的目标是“系统化编译器对程序优化转换的大杂烩”。[据说只实现本文中的八种主要技术](https://thenewstack.io/rust-creator-graydon-hoare-recounts-the-history-of-compilers/)的编译器可以实现 80%的最佳性能。以下是一些最基本的想法:

*   过程集成:尽可能用内联代码替换对子程序的调用，避免保存/恢复寄存器
*   [循环展开](https://en.wikipedia.org/wiki/Loop_unrolling):通过显式写出语句来展平循环，避免不必要的比较条件
*   CSE(公共子表达式消除):消除计算已有值的冗余计算
*   [代码运动](https://en.wikipedia.org/wiki/Loop-invariant_code_motion):将子表达式移出循环，这样做是安全的
*   窥视孔优化:用更有效的变体取代已知的指令组合

其中一些现在对我们来说似乎是显而易见的，但是将这些想法正式化和标准化在当时产生了巨大的影响。

## 平行

Allen 为 IBM 做的最后一个主要项目是并行翻译器 PTRAN。这是一个自动并行系统，一种特殊类型的编译优化。我们的目标是将那些没有考虑到并行性的程序转化为在并行架构上执行的程序。这种获取顺序编写的代码并从中自动提取特性以并行运行的概念导致了依赖图的广泛使用，现在是编译器中的标准表示。艾伦职业生涯中反复出现的一个主题是，她能够将高度技术性的问题抽象成数学——通常是图形和集合——并精确地解决它们。在这个项目中，Allen 领导了一个年轻的工程师团队，用 15 年的时间编写了业界领先的并行论文和编译器。

## IBM 学院及其他

1995 年，艾伦成为 IBM 研究院的院长，这是一个由 IBM 顶尖技术人员组成的内部指导小组。她能够利用这个职位在两个领域进行宣传:指导和技术领域的女性。在采访中，她经常谈到她如何没有导师，以及这对刚开始从事科技行业的人有多重要。她作为该领域专家的知名度鼓舞了其他人——在 70/80 年代的巅峰时期，IBM 实验编译器团队中有一半是女性。她对科技行业女性的倡导从未停止过，即使她描述了在早期计算机时代之后女性参与率的下降:

> 后来，随着计算机成为一个专业领域，雇主开始要求工程证书，这在传统上很少吸引女性。但随着女性从医学信息学、用户界面和教育中的计算机等其他领域进入该领域，钟摆又摆了回来。

2006 年，艾伦获得了图灵奖(被认为是诺贝尔计算奖)——第一位获得该奖项的女性。

所以下一次你启动 gcc，用汇编以上的语言写任何东西，或者甚至使用任何软件，记住 Frances Allen 的想法是无形的。