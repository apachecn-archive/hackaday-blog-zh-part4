# 维修:Disklavier DKC500RW 控制单元

> 原文:[https://hack aday . com/2019/06/03/repair down-disklavier-dkc 500 rw-control-unit/](https://hackaday.com/2019/06/03/repairdown-disklavier-dkc500rw-control-unit/)

如果你一直好心地陪我进行这些常规的硬件探索，你可能已经认识到一种趋势，那就是接受手术的小工具。总的来说，我为了让你看得开心而拆开的设备是从大型零售商店、旧货店或易贝总是慷慨的“原样”商品区的清仓架上拿到的。每次我拿起一件设备进行解剖时，都会进行某种成本效益分析，你可能不会惊讶地发现，橱窗里最便宜的小狗通常是能保证它在互联网上出名 15 分钟的那只。

[![](../Images/fa658dd90df9801d276783e7834f866e.png)](https://hackaday.com/wp-content/uploads/2019/05/disklavier_piano.jpg)

DKC500RW installed on right side.

但是，亲爱的读者，这个月我要向你呈现一些不同的东西。这一次，我不是仅仅为了看到 PCB 暴露在外的简单快乐而拆开一些东西。我被赋予修理一件昂贵的陈旧古怪设备的任务，因为，坦率地说，没有人愿意做这件事。如果我们碰巧发现自己在这个过程中了解了它的内部工作方式，那只是和一个黑客作家做生意的成本。

向我解释的情况是，在 20 世纪 90 年代末，我哥哥的雇主以大约 20，000 美元的价格购买了一架雅马哈马克 2 号 XG“小三角”钢琴。这种特殊的型号被选中是因为它能够播放 3.5 英寸软盘上的 MIDI 文件，并具有按键自行移动的鬼魅效果。这个想法是，你可以在你的大厅里放上这架钢琴，里面有一张软盘，里面装满了巴瑞·马尼洛最著名的歌曲，你的房间马上就会充满自动化的课程。

不幸的是，大约一个月前，钢琴的 Disklavier DKC500RW 控制单元停止读取磁盘。钢琴本身仍然工作，但现在需要一个人来演奏。打了电话，但正如你所料，大多数维修中心在听到“软盘”这个词时都礼貌地拒绝了，任何在线的人都报出了根本不划算的价格。

在他们雇佣钢琴师之前，也许这是一个人类承担机器人工作的罕见例子，我的兄弟问他是否可以移除控制单元，看看我是否能理解它。因此，让我们深入挖掘这件古老的音乐设备，看看在千年之交五位数的价格标签能给你带来什么。

## 美丽是肤浅的

DKC500RW 的外观和手感让我想起了 21 世纪初的 DVD 播放器，那时候它们还没有开始在杂货店销售。它有一个很好的坚固的结构，所有的按钮和控制感觉非常像你所期待的一件和一辆车一样贵的装备。雅马哈确保这款产品具备昂贵电子产品的所有特征，至少在外观上是如此。

[![](../Images/032c6d9dff860af8ba751194ffcb984e.png)T2】](https://hackaday.com/wp-content/uploads/2019/05/disklavier_internal.jpg)

不过在里面，它看起来就像一台廉价的录像机。半满的褐色印刷电路板和杂乱的布线立刻让我想起了布满灰尘的旧货店小玩意，在后 RadioShack 时代，我偶尔会拆开这些小玩意寻找元件。总的来说，设备的内部很邋遢，看起来像是在最后一刻被扔在一起的。非常失望。

## 一个尺码最合适

我无法从丝网印刷上的各种数字中找到任何有用的信息，但我得到了清晰的印象，DKC500RW 中的主 PCB 应该在 Disklavier 系列的其他设备中共享。在这种情况下，另一个 PCB 是事后的想法；使主板在这种特定配置下工作所必需的垫片。当然，构建质量和电路板复杂性的差异是不分昼夜的。

[![](../Images/83c324a03c5be9b46f8abc581bc2aa3e.png)](https://hackaday.com/wp-content/uploads/2019/05/disklavier_cpu.jpg) 还有大量未使用的连接器，它们可能会连接到备用的控制面板或存储设备。从我哥哥做的研究来看，似乎有些控制单元配备了光驱甚至硬盘。我很想看看其中一个高端型号的内部，看看它们的对比如何。

这里展示的明星是 Hitachi SH7032，一款运行速度为 20 MHz 的 32 位 RISC 处理器。顺便提一下，这种芯片(或至少是一种类似的变体)似乎受到 Rockbox 的支持，rock box 是一种用于数字音频播放器的开源固件。因此，如果你正在寻找一个挑战，并在一次交易会上看到这些控制单元中的一个，[你可能会尝试让它运行 DOOM](https://hackaday.com/2016/12/30/sansa-mp3-player-runs-doom-unplayably/) 。

环顾电路板，我们还可以看到三菱公司的 8 位微控制器 M38881M2，它连接到几个 74AC574 触发器。似乎这个芯片代表 SH7032 负责与前面板控制接口。在通向软驱的带状电缆旁边，还有一个 HD63266F 软驱控制器。许多其他芯片的标记模糊不清，但似乎在任何情况下都不会有很多惊喜。

## 问题的根源

找出 DKC500RW 故障的第一步是打开它的电源。不幸的是，我找不到连接主机钢琴的 DE-15 连接器的引脚，也不知道该给它什么电压。但是我*有没有*看到一个 LM7805，它的主板上有一个结实的散热器，在将可调电源连接到输入和接地引脚后，它毫无怨言地启动了。

我试了几个用于系统的磁盘，果然设备报告它们不可读。即使空白磁盘也会立即在屏幕上显示错误信息。浏览设置时，我注意到它有格式化磁盘的功能。出于对会发生什么的好奇，我给了它一张空白磁盘，等待它完成。一旦格式化，DKC500RW 立即识别磁盘。**啊哈**。

[![](../Images/3d756208de1122acb68cb8df2acc7c74.png)](https://hackaday.com/wp-content/uploads/2019/05/disklavier_floppycon.jpg)

You’re not fooling me, Yamaha.

现在可能有很多人在读这篇文章，他们以前从未使用过软驱，也不知道为什么这一转变意义重大。基本上，软盘驱动器变得如此不对齐，以至于它只能读取自己格式化的磁盘，这种情况并不是没有听说过。如果你有神奇的技巧，在这种情况下重新调整驱动器是可能的，但我不知道有谁曾经亲自完成过。

我哥哥已经从一家仍在为这些钢琴提供服务的公司得到了一个几百美元的替换软盘驱动器的报价，但看着它，它对我来说似乎没什么特别的。这似乎是一个基本的笔记本电脑软盘驱动器，与某种引脚转换适配器连接。把它拆开后，我终于能够在硬盘上找到标记，证明它是一台三菱 D353F3。易贝以 8 美元的天价购买了一个替代品，安装后，DKC500RW 能够读取我们扔给它的每一个磁盘。

## 数字考古学

[![](../Images/c22a7fc92d0b12d02ef964c0578c2915.png)](https://hackaday.com/wp-content/uploads/2019/05/disklavier_disks.jpg) 我哥哥把 DKC500RW 带回他的工作岗位，重新安装后没有任何问题，现在可以再次听到科帕卡巴纳甜美的声音在大厅里飘荡。他是大英雄，而我默默无闻。这就是生活。

但实际上事情远不止如此。在替换硬盘到达的一周左右的时间里，我开始想，在这些古怪的雅马哈 MIDI 磁盘被送回之前，我能为它们做些什么。原来，作为 DRM 的基本形式，磁盘没有引导扇区或传统的文件分配表(FAT)。因此，任何试图安装它们的操作系统都会认为它们已损坏。

然而，通过十六进制编辑器和我不愿承认的大量时间，我能够找出磁盘的结构。从那时起，我开始编写 Python 脚本，它可以从磁盘映像中列出并提取单个音频文件。万一你对从你个人收藏的 Yamaha Disklavier 3.5 英寸软盘中抓取 MIDI 文件感兴趣，[你可以在它的 Hackaday.io 页面](https://hackaday.io/project/164793-hacking-yamaha-disklavier-floppies)跟随这个项目。