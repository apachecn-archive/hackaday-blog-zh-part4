# 1 万亿美元退款！(随附 PDF)

> 原文：<https://hackaday.com/2019/03/06/1-trillion-usd-refund-pdf-enclosed/>

安全研究人员发现，有可能在不使签名无效的情况下对数字签名的 PDF 进行修改。为了证明这一点，他们制作了一份价值 10 亿美元的伪造文件“退款单”，上面有亚马逊的有效签名。这引起了我的注意，因为我非常确定他们没有使用某种量子设备来破解签名过程中涉及的加密技术。那么到底是怎么回事呢？

研究人员声称发现了至少三种不同的方法，用他们的话说:

> …使用现有的签名文档(例如 amazon.de invoice ),在不使签名无效的情况下任意更改文档内容。因此，我们可以伪造一份由 invoicing@amazon.de 签署的文件，退还我们一万亿美元。

如果考虑到对文档进行数字签名的主要目的是防止对文档进行未经授权的更改，这可不是什么好消息。好消息是，由于这项研究，你可以更新你的软件来修复这个缺陷；主要的 PDF 阅读器公司被给予时间来解决问题。坏消息是，如果您依赖签名验证来处理任何敏感的流程，您可能会想回去看看您以前是否使用了易受攻击的软件，并检查文档是否得到了正确的验证。我考虑的是政府机构，银行，保险公司等等。

其中的含义还有待观察，甚至可能还不完全清楚。

针对不同软件的攻击分为三类。我将从阅读研究报告中了解每一个问题。

**通用签名伪造(USF)**

这种攻击通过操纵 PDF 文件中的签名对象来实现。该对象包含验证签名所需的信息，并且在其他字段中包含用于计算签名哈希的字节偏移量。这里的技巧是将内容添加到已经签名的 PDF 中，但是要么删除这个范围，要么将其更改为无效值。结果是一个 PDF，其中有一个有效的签名，但一个无效的签名对象。一些测试软件中的验证逻辑默认显示签名有效，并放弃任何关于无法计算签名散列的警告。

**增量保存攻击(ISA)**

在其原始形式中，这与其说是一种攻击，不如说是一种功能。PDF 允许增量保存，即将内容添加到现有的 PDF 文件中。通过获取已签名的 PDF 并添加未签名的内容，阅读器软件应该会注意到添加的部分未签名并显示警告。但是有可能以不符合 PDF 规范的方式添加内容，使读者在进行签名检查时没有注意到最初添加的内容，并且仍然在屏幕上呈现内容。

**签名包装(SWA)**

这最后一次攻击可以说是最有趣的。攻击者不是像 USF 攻击那样使字节范围偏移量无效，而是操纵签名的 PDF 文件字节范围字段，在签名和文件结尾之间插入内容。这使得软件正确地计算签名散列，但是它跳过添加的部分，因为它没有在字节范围中被引用。

## **研究人员**得出结论

从 22 个接受测试的桌面阅读器和 7 个在线验证服务来看，除了 3 个以外，所有的都容易受到至少一种攻击。这大约是 90%,所以你最喜欢的 PDF 阅读器最有可能在那个列表上。当然，可能你连签名验证都不直接用。但是你的银行可能会。

不幸的是，大多数阅读器软件都是闭源的，如果不能访问阅读器的源代码，研究人员就很难确定是什么导致了这种错误的行为。据他们所知，可能有两个主要原因:

> 该规范对签名非常模糊，尤其是如何验证签名。被分析的读者对打开、验证和显示格式错误的 PDF 文件非常宽容。

有趣的是，在模糊规范的背景下，许多不同的实现和公司都在犯同样的错误。最后一个结论似乎有点明显。容错软件[在](https://hackaday.com/2019/01/24/cool-tools-a-little-filesystem-that-keeps-your-bits-on-lock/)[很多情况下](https://hackaday.com/2019/01/25/circuit-vr-redundant-flip-flops-and-voting-logic/)可以是好的，但是在签名验证中就不行了。

这是一个软件绝对不能容忍的场景。