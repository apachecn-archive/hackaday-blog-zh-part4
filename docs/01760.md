# UPnP，漏洞是一个不会消失的特性

> 原文:[https://hack aday . com/2019/01/14/UPnP-vulnerability-as-a-feature-that-just-wont-die/](https://hackaday.com/2019/01/14/upnp-vulnerability-as-a-feature-that-just-wont-die/)

UPnP——在一个完美的世界中，随着我们向家庭网络添加更多设备，它将成为许多连接难题的答案。但是在实践中，当涉及到保证网络安全时，它是许多令人头痛的原因。

很可能许多 Hackaday 读者向亲戚或朋友提供了某种形式的技术支持。我们将帮助整理妈妈的桌面和电子邮件抱怨，我们将设置她的新路由器并尽可能地锁定它，以尽量减少坏人给她带来问题的机会。也许我们首先要做的事情之一是我们社区中的旧闻；为了确保一个暴露于外界的臭名昭著的漏洞被堵塞，我们禁用了她的提供商提供的任何电缆调制解调器或 ADSL 路由器上的 UPnP。

## YouTube 恶作剧

[![Turning off the enabled-by-default UPnP in an older BT HomeHub pulled from the surplus router pile.](../Images/ff75c5c53fec319562d36c4f243da74b.png)](https://hackaday.com/wp-content/uploads/2019/01/bthomehub-screenshot.jpg)

Turning off the enabled-by-default UPnP in an older BT HomeHub pulled from the surplus router pile.

你可能会认为，利用 UPnP 的不光彩历史，路由器自动启用它的日子将成为过去，但我们从一个意想不到的来源得到提醒，这可能不是事实。YouTube 明星 PewDiePie(有争议的瑞典游戏评论家和喜剧演员)和 T-Series(印度唱片公司)正在争夺令人垂涎的~~最烦人~~最多用户的桂冠。这位瑞典人的粉丝似乎转向了邪恶的策略，先是[向全球曝光的网络打印机](https://hackaday.com/2018/12/07/weaponized-networked-printing-is-now-a-thing/)发送垃圾邮件，最近又在无数联网的媒体播放器和电视上播放他的视频。正是在这里，我们再次见到了我们的老朋友 UPnP，因为在这些攻击中，它被歹徒用作漏洞[，通过它他们可以访问谷歌的 Chromecast 播放器](https://www.bbc.co.uk/news/technology-46746592)。

## 剥去所谓的黑皮

媒体当然报道这是精英黑客的作品，毫无疑问，他们穿着帽衫，戴着墨镜，狂热地在绿色屏幕显示器上敲打代码。真相并不那么迷人，它存在于敞开的大门的偶然交汇中，这更多地是因为他们只是抓住了一个赋予他们的机会，而不是因为 1337 年 5k1lz 的任何概念。要解开它，我们需要退后一步，看一看所涉及的协议。

[![We know what hackers look like because the BBC had some on the telly just before Christmas!](../Images/c77a7bb36a31a5d0d24740380568aba5.png)](https://hackaday.com/wp-content/uploads/2019/01/bbc-hackers-2018-12-22.jpg)

We know what hackers look like because the BBC had some on the telly just before Christmas!

通用即插即用是一种协议，旨在确保家庭联网设备自动发现彼此并正常工作。它的目的是将非技术家庭用户从手动网络配置中解放出来，它通过允许设备用标准的 XML 设备描述来宣布它们自己，该描述包含关于它们的能力和访问它们所需的 URL 的信息。就其本质而言，它是一个完全开放的协议，几乎没有安全性，而是依赖于连接到私有家庭网络。

历史上，许多路由器默认启用 UPnP 访问互联网，这意味着路由器内部的漏洞可以被利用，安全性差的设备可以使用它来请求向外界开放端口。解决方案是关闭路由器中的 UPnP 访问，正如我们上面提到的，但遗憾的是，即使这一步也超出了大多数家庭用户的能力。经常阅读 Hackaday 的读者会记得[我们以前报道过这个话题](https://hackaday.com/2016/10/06/how-to-become-part-of-an-iot-botnet/)，[上一次做更一般的新闻服务](https://hackaday.com/2016/09/26/extra-large-denial-of-service-attack-uses-dvrs-webcams/)。

## 当然，任何人都可以用我的电视！

[![The BishopFox RickMote automated Chromecast hijacker from 2014\. (GPL3.0)](../Images/a709c34ce1356c0d1ee6aede97c5b4f8.png)](https://hackaday.com/wp-content/uploads/2019/01/rickmote.jpg)

The BishopFox RickMote automated Chromecast hijacker from 2014\. ([GNU GPL 3.0](https://github.com/bishopfox/rickmote))

在这条相对薄弱的防线背后，是 Chromecast。这是一种使用手机或平板电脑作为客户端连接电视的便捷方式，[它的易用性归功于 UPnP](http://geeknizer.com/how-chromecast-works-chromecast-protocol-explained/) ，因此很容易说服任何能够访问其所在网络的人播放 YouTube 视频。[利用它没有什么新意](https://www.bishopfox.com/blog/2014/07/rickmote-controller-hacking-one-chromecast-time/)，所以媒体对超级黑客的气喘吁吁的描述是错误的。

鉴于如此多的家用路由器仍然支持 UPnP，并且联网电视不再像几年前那样是尖端的古怪产品，PewDiePie 视频很可能只是一个开端。在上面链接的打印机故事中，我们的同事汤姆·纳尔迪打趣道，一个由可疑公司组成的新兴行业提供所谓的打印机广告，在联网电视领域为这种不良的未来愿景添加了侵入性广告。当这种情况发生时，我们无疑会看到很多愤慨，但令人悲伤的事实是，除了敦促尽可能多的人关闭他们路由器上的 UPnP 之外，很可能对此无能为力。

制造商通常不关心他们过时的产品，因此不太可能发布固件更新来修复受影响路由器上的问题，即使他们确实发布了此类更新，在大多数情况下也需要手动安装。我们倾向于认为，目前发货的路由器默认情况下没有启用 UPnP，几年的硬件更换周期会使问题消失，但我们没有证据表明这是事实，不知何故，我们怀疑这可能是一个有点太大的希望。与此同时，我们所能做的就是尽可能多地制造噪音，让我们周围的路由器尽可能地保持最新和安全，并在下一次这个故事进入公众意识时，看起来洋洋得意。

头图:第一代 Chromecast，Ericajoy ( [CC BY-SA 2.0](https://commons.wikimedia.org/wiki/File:Chromecast_dongle.jpg) )。