# 本周的安全性:Fail2RCE、TPM 嗅探、可疑漏洞和反编译

> 原文：<https://hackaday.com/2021/07/30/this-week-in-security-fail2rce-tpm-sniffing-fishy-leaks-and-decompiling/>

Fail2ban 是一个很好的工具，可以动态阻止表现不良行为的 IP 地址，比如重复登录。刚刚宣布[一个漏洞可能允许攻击者通过被 Fail2ban 阻止来接管一台机器](https://github.com/fail2ban/fail2ban/security/advisories/GHSA-m985-3f3v-cwmm)。问题出在`mail-whois`行动中，在该行动中，向管理员发送了一封包含 whois 信息的电子邮件。Whois 信息是潜在的攻击者控制的数据，Fail2ban 在将输入数据传输到`mail`二进制文件之前没有对其进行适当的消毒。Mailutils 有一个特性，它使用代字号键作为转义序列，允许在编写消息时运行命令。Fail2ban 不清理这些波浪号命令，所以恶意的`whois`数据可以在系统上运行命令。`Whois`是一种以明文形式运行的老式 unix 协议，因此 MItM 攻击使这变得特别容易。如果您使用 Fail2ban，请确保更新到 0.10.7 或 0.11.3，或者从您的活动配置中清除任何对`mail-whois`的使用。

## 通过嗅探 TPM 来破解加密

"一旦你有了实际接触，所有的赌注都取消了."这似乎是一个再次被证明是正确的咒语，即使现代技术正在试图击败它。这个故事开始于[Dolos Group 的红队从他们的客户](https://dolosgroup.io/blog/2021/7/9/from-stolen-laptop-to-inside-the-company-network)处收到一台“失窃”的笔记本电脑。面临的挑战是，查看能够访问公司笔记本电脑的攻击者是否能够使用它来入侵受保护的公司网络。笔记本电脑被很好地锁定，通过可信平台模块(TPM)和 Bitlocker 进行全磁盘加密。

那就不可能有任何进展了，对吧？不完全是。笔记本电脑没有配置为需要密码或 PIN 才能启动。在此配置中，TPM 会在引导期间自动将加密密钥发送到引导加载程序。该密钥以明文形式通过 SPI 接口发送。所有需要做的就是在引导期间探测 SPI 总线。虽然 TPM 的物理尺寸很小，这使得它非常困难，但 SPI 接口是一条总线，这意味着它可以连接板上的多个芯片。其中之一是具有大得多的引脚的 CMOS 芯片。捕获成功，他们很快就可以访问加密驱动器上的文件系统。除了一个 VPN 客户端之外，对这台特殊的机器没有太多的兴趣。

为了获得对该客户端的访问权，攻击者选择使用一个非常古老的技巧来绕过 Windows 登录——粘滞键后门。如果你不熟悉这个聪明的技巧，请做笔记。当您可以访问机器的驱动器，但没有机器上的用户帐户时，您可以通过复制少数系统二进制文件中的一个来绕过登录。虚拟键盘二进制是一个流行的选择，但在这种情况下，选择了`Utilman.exe`(粘滞键)。他们将修改后的映像作为虚拟机启动，并在登录屏幕上使用 Windows + U 组合键启动命令 shell。由于机器本身已经通过 VPN 连接，并通过机器帐户登录到域中，他们在内部网络中有了一个立足点。将一个文件上传到其中一个服务器上的 scanner 目录就足以赢得渗透测试。

## 可疑的俱乐部数据集

时尚的音频社交网络 Clubhouse 是一个新的数据收集故事的中心。在一个暗网论坛上，[一个用户正在出售一个包含 38 亿个电话号码的数据库](https://www.opindia.com/2021/07/experts-rubbish-claim-of-clubhouse-data-leak-made-by-hacker-forum/)，据称是从俱乐部服务器上获取的。这很奇怪，因为数据库里只有电话号码。俱乐部会所已经宣布，这不是一个有效的泄漏，他们认为这些数字是随机产生的。数量庞大，基本上没有额外的信息，足以使数据库无用，即使它是真实的。这里似乎没什么可担心的。

## 在 Linkedin 上猜名字

![](img/2a1d38a0056a7201db27c89e32057772.png)一个不完全是炒作的刮痧技术是[的`revealin`工具](https://github.com/mxrch/revealin)，来自【mxrch】。该工具获取隐藏姓氏的用户的个人资料，并一次显示一个字母的完整姓名。这是一个很棒的工具，但是你可以在 Linkedin 主页上自己动手做。问题在于 Linkedin 搜索功能，它将每次击键发送到服务器，以更新可能匹配的列表。匹配算法可以访问完整的姓氏，因此您可以一次一个字符地找出姓名。以托马斯·h 为例。输入这么多，他个人资料的链接就会出现在列表中。加个" a "就没了。继续尝试，直到你猜出一个“e”，并且轮廓仍然在那里。现在你知道第二个字母是 e。`Revealin`流程完全相同，只是速度更快。我确实测试了一下，发现它很有效，直到我开始触及 Linkedin 的限速。冲洗并在一千个云实例上重复？总而言之，这是一个聪明的小工具。

## 16 岁的臭虫

你可能在你的 Windows 机器上安装了[一个易受攻击的驱动程序。惠普、施乐和三星打印机驱动程序都安装了 SSPORT 驱动程序，其中包含 CVE-2021-3438，这是一个 16 年前的漏洞。寻找`C:\windows\system32\drivers\ssport.sys`。它包含一个小的缓冲区溢出，可用于本地权限执行。更新的驱动程序可用，或者如果您不再使用依赖该驱动程序的打印机，您可以卸载该驱动程序。](https://labs.sentinelone.com/cve-2021-3438-16-years-in-hiding-millions-of-printers-worldwide-vulnerable/)

## 依赖性安全性

长期以来，供应链攻击一直是一个大问题。上游包或库被破坏的危险在最近的历史中已经出现过几次，像`event-stream`和依赖混淆攻击。Gitlab 和 Github 都宣布了试图改善这种情况的项目。Gitlab 的 [Package Hunter](https://github.blog/2021-07-22-github-supply-chain-security-features-go-community/) 是一个行为剖析工具，它将你的代码和依赖项组装在一个沙箱中，并通过它的步伐寻找奇怪的行为。缺点是目前仅限于 NodeJS 和 Ruby 项目。即便如此，它也应该是 CI 渠道的一个有用的补充，可以立即发现问题。

Github 已经有了一些供应链安全特性，比如我们在本文开头的 Fail2ban 故事中链接的安全顾问数据库条目。消息是[他们将这些功能带到](https://github.blog/2021-07-22-github-supply-chain-security-features-go-community/)。这包括咨询、依赖关系图、已公布漏洞的自动警报，甚至更新易受攻击的依赖关系的自动请求。这是一套有用的工具，很高兴看到它们也可以用于另一种语言。

## 面向~~假人~~初学者的逆向工程

你有一个二进制文件，你需要知道它在做什么。简单，只是反编译它！现在我们有了像 Ghidra 这样的工具，把那个 *jmp* 组装起来就相当容易了。但是如果你从来没有做过汇编编程，那么`push`、`mov`和`pop`命令列表并不比原始的机器代码有用多少。好吧，把[萨米·阿拉维·肯德尔]的这篇快速指南加入你的阅读清单。他涵盖了您应该知道的基本汇编命令和模式，以便遵循执行流程。正如罐头上所说，这是阅读反编译代码的极好指南。