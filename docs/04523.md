# 本周的安全:美国数字咖啡馆，没有的 Linux 错误，伟大的国家，等等

> 原文:[https://hackaday . com/2019/10/18/this-week-in-security-a-digital-cafe-America in-the-Linux-bugs-that-not-the-great-nation-and-more/](https://hackaday.com/2019/10/18/this-week-in-security-a-digital-cafe-americain-the-linux-bugs-that-werent-the-great-nation-and-more/)

摩洛哥政府正在追捕一名人权活动家。这听起来很熟悉，但我认为汉弗莱·鲍嘉这次不是在经营酒馆。

撇开可疑的卡萨布兰卡参考，大赦国际报道了另一起针对人权工作者的袭击。在这种情况下，一对摩洛哥活动人士被 NSO 的飞马恶意软件套件攻击。研究人员发现了导致恶意网页的短信网络钓鱼，以及针对他们移动设备的 HTTP 中间人攻击。一旦目标被成功定向到恶意网站，零日漏洞的集合就被用来危害带有 NSO 恶意软件的手机。

NSO 是一家以色列公司，专门为政府开发恶意软件和其他网络安全工具。可以想象，这种专业化为 NSO 赢得了相当多组织的蔑视。NSO 声称有一个政策框架，允许他们评估和终止使用他们的软件，当它被认为是非法或滥用时，但由于他们的合同的性质，这个过程是不透明的。

### Sudo 漏洞

sudo 的一个问题在本周被披露，该问题允许用户以 root 用户身份运行命令，即使他们没有权限这样做。Sudo 允许用户指定数字用户 ID，而不是用户名。人们发现，指定-1 作为用户做了一些意想不到的事情，它失败了。尝试切换到 user -1 失败了，但是 sudo 仍然以 root 而不是 user -1 的身份运行命令的其余部分。我很高兴在一个稍微过时的系统上测试这个简单的漏洞。我创建了一个非特权用户，运行 sudo 命令，得到了预期的安全错误，但是没有 root 访问权限。

[![](../Images/3ca31c12f3731576a780cfe52d2a15ee.png)](https://hackaday.com/wp-content/uploads/2019/10/sandwich.jpg)

There’s an [xkcd](https://www.xkcd.com/149/) for everything.

[实际的利用](https://www.sudo.ws/alerts/minus_1_uid.html)需要一个非常特殊和不寻常的系统配置。用户必须被添加到 sudoer 文件中，并且拥有作为除 root 之外的任何用户运行的权限。这实际上意味着除 0 之外的任何用户 ID 都是允许的。用户 ID-1 通过了除 0 (root)之外的任何测试，但是在尝试切换用户时，以 root 身份运行命令会导致失败。

退一步说，允许用户访问除 root 之外的所有内容并不是一个好的安全策略。最明显的是，如果任何其他用户有权限通过 sudo 以 root 用户身份运行命令，那么特权较低的用户可以简单地使用 sudo 以管理员帐户的身份运行 sudo。

在某些方面，一个类似的故事，在 Linux 内核的 Realtek 驱动程序中的一个[问题在周一被发现。乍一看，这是另一个可怕的漏洞，它影响着每一个使用 Realtek 无线网卡的 Linux 用户。这似乎是一个标准的缓冲区溢出，其中以一种方式检查字段的长度，但不检查是否低于最大长度。长于预期的数据字段将溢出缓冲区并导致问题。尚未发现代码执行漏洞，但最终很可能会被发现。](https://arstechnica.com/information-technology/2019/10/unpatched-linux-flaw-may-let-attackers-crash-or-compromise-nearby-devices/)

这个 bug 的问题是，在调用易受攻击的代码之前，驱动程序会检查卡当前是否以 p2p 模式连接。如果你感兴趣，这是问题中的支票。这意味着，除了在 Realtek 开机时容易受到攻击之外，除非您使用 p2p WiFi 模式与另一台设备通话，否则您实际上不会面临风险。在我这些年做的所有 Linux WiFi 工作中，我想我还没有在 Linux 下的无线卡上使用过 p2p 模式。

这些错误被发现很好，更好的是它们得到了修复。也就是说，这些都是在一些报道中被夸大了的小众案例。

### 研究伟大的国家

作为开放技术基金的一部分，红队实验室与 Cure53 合作，对一款中国移动应用程序“研究伟大的国家”进行了详细的研究。这项申请是由中国政府，特别是中国共产党赞助的。乍一看，这似乎是一个相当简单的教育工具，教授学生有关中国历史的知识，并通过测验和公共排行榜鼓励竞争。

[![](../Images/927459178704a451762cb77a18ec3771.png)](https://hackaday.com/wp-content/uploads/2019/10/qwe_download.jpg)

Image: [The Independent]("https://www.independent.co.uk/news/world/asia/china-xi-jinping-app-millions-forced-download-a8859511.html')

审计揭露了比简单的教育工具更不正当的活动。该应用程序从手机中收集数据，包括安装的其他应用程序的信息，已拨打的电话，甚至设备的当前位置。这些数据被上传到中国政府。

一些更耸人听闻的故事声称这个应用程序包含一个针对根手机的超级用户后门。至少，该应用程序会尝试确定运行它的手机是否已经被 rooted。查看代码片段，我看不出有任何东西可以绕过 SuperSU 之类的根管理软件。有一个功能被设计为以 root 用户身份运行命令，但如果没有利用漏洞，只要 root 设备安装了 SuperSU 或类似的实用程序，这仍然是用户控制的。

该应用程序还要求访问麦克风和摄像头，据报道是为了与其他应用程序集成。理解这些权限如何被滥用并不需要很大的想象力。

Cure53 的报告指出，构成这款应用的 Java 代码被严重混淆，而且并非所有代码都被成功解除混淆。可能仍有令人不快的惊喜潜伏着。

### 入侵终端

Mozilla 资助的对 iTerm2 [的审计发现了一个令人惊讶的漏洞](https://blog.mozilla.org/security/2019/10/09/iterm2-critical-issue-moss-audit/)。iTerm2 是 MacOS 的开源终端替代品，增加了许多功能，包括内置的 tmux 集成。人们发现，某些终端输出会被解释为 tmux 命令，从而导致在运行该终端的机器上执行代码。

这导致了一个有趣的场景，通过 SSH 或 Telnet 连接到远程服务器的行为将允许利用这个漏洞。Curl 的默认行为是将下载的文件直接输出到终端，这也可能触发 bug。

### 黑客入侵

安全行业经常要回答的一个问题是，我们为什么不简单地黑掉黑客。这是一个持续多年的争论，但是偶尔有人决定自己解决问题。【Tobias fr Mel】被 Muhstik 勒索病毒蛰了，咳出 0.09 比特币拿回自己的文件。这肯定让他吃了一惊，因为[Tobias]追踪到了命令和控制服务器，并发现这是一个合法的服务器，已经被入侵并增选运行勒索软件活动。他发现了原始攻击者留下的远程访问外壳，并利用它来访问服务器。从那里，他转储包含密钥的数据库，并向全世界发布。

这是一种高尚的姿态，但也仍然是非法的。我猜(也希望)[托拜厄斯·弗勒梅尔]是个假名，这个数字义务警员对自己的真实姓名保密。无论如何，哔哔声电脑报告说，许多 Muhstik 受害者已经能够恢复他们的数据。我不确定[托拜厄斯]是否是我们应得的英雄，或者仅仅是我们需要的英雄，但他肯定是穆什蒂克受害者的英雄。