# 新零件日:适用于 IEEE1588 精确时间协议的树莓皮帽子

> 原文：<https://hackaday.com/2021/08/16/new-part-day-raspberry-pi-hat-for-ieee1588-precision-time-protocol/>

InnoRoute 的新的[实时帽子](https://innoroute.com/realtimehat/)增加了 [IEEE1588](https://en.wikipedia.org/wiki/Precision_Time_Protocol) PTP 在硬件上对躺在下面的树莓 Pi 4 的支持。基于 Xilinx Artix-7 FPGA 和少量千兆以太网 PHY 设备，HAT 充当网络通道，向出口(传出)数据包添加准确的时间戳，并从入口(传入)端剥离时间戳。

这种硬件时间戳包括使用 Raspberry Pi 没有的专用网络硬件动态重写以太网数据包。是的，有纯软件的 1588 堆栈，但它们只能达到几十微秒的分辨率，不像硬件方法可以达到几十纳秒。

1588 广泛用于电信基础设施、工厂设备控制以及任何需要数据消耗或数据产生设备同步的应用。欧洲粒子物理研究所大量使用 1588 作为其巨大的传感器和控制设备阵列，用于所有的 LHC 实验。这就是[白兔系统](https://white-rabbit.web.cern.ch/)，大概是以《爱丽丝梦游仙境》中沉迷于时间的白兔命名的。因此，如果您有一个大型的安装，并且需要精确地控制它上面发生的事情，这可能就是您正在寻找的东西。

## IEEE1588 PTP 同步

PTP 客户端和主设备相互之间来回 ping 几条消息，网络时间戳记录数据包通过接口的精确时刻。这些时间戳是用本地时钟记录的。这很重要。根据这些测量，可以计算并校正分组的飞行时间和本地时钟相对于远程时钟的偏移。以这种方式，网络中的每个客户端节点(hat)将具有相同的当前时间概念，因此流经整个网络的所有网络分组可以被同步。

该系统的优点在于，网络交换机、布线和所有公共基础设施不需要使用 1588，也不需要任何其他特殊功能，它们只需要传递数据包，理想情况下具有一致的延迟。

实时 HAT 通过 SPI 配置其 FPGA，[直接来自 Raspberry Pi 操作系统](https://github.com/InnoRoute/RealtimeHAT)，只需更改命令行即可实现多种应用。可以上传自定义比特流，如果您愿意，可以将 HAT 用作通用 FPGA 开发板。它甚至可以与官方的 PoE 帽子堆叠在一起，这使得它对于在单根电线的末端悬挂传感器更加有用。

当然，如果你的需求比一个瑞士城市更简单、规模更小，你只需要用一点焊接技术将 GPS 时钟源改装成树莓皮就可以了。