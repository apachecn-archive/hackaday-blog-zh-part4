# 本周在安全:UTorrent 易受攻击，众包你的失败 2 班，和密码在赌场

> 原文：<https://hackaday.com/2020/09/25/this-week-in-security-utorrent-vulnerable-crowd-sourcing-your-fail2ban-and-cryptographers-at-casinos/>

uTorrent 客户端最近进行了[更新，修复了由【whtaguy】发现的空指针取消引用](https://blog.whtaguy.com/2020/09/utorrent-cve-2020-8437-vulnerability.html) (CVE-2020-8437)。触发解引用只会使客户端崩溃——到目前为止，还没有找到真正的 RCE。鉴于空指针取消引用的性质，这个错误可能仅限于拒绝服务。这非常好，因为这个漏洞非常容易被发现。

BitTorrent 是一个聪明的协议。它仍然被用来分发大文件，比如 Linux ISOs。这个概念很简单:将一个大文件分割成小块。一次向一个客户端发送一个块。当接收到每个数据块时，客户端会将该数据块的副本发送给下一个客户端。由于这种对等(p2p)安排，服务器可用的带宽大大增加。与所有其他 p2p 协议一样，症结在于如何在对等体之间建立连接，尤其是当世界上大多数台式机都位于 NAT 路由器之后的时候。实际上，要让两个对等体共享数据，至少其中一个对等体必须打开一个端口，或者将端口转发给客户端。这通常通过通用即插即用(UPnP)或 NAT 端口映射协议(NAT-PMP)来实现。两个协议的思想是相同的；内部设备上的客户端无需手动干预即可请求临时端口转发。允许自动端口转发是否是一个好主意是另外一个问题。

BitTorrent 使用定制的数据序列化方案 bencode，在两者中包含更复杂的数据结构。torrent 文件，以及连接时对等体之间发送的握手。Bencode 可以表示多种数据类型，其中一种是字典类型。这里有趣的是，字典可以包含一个字典作为值，并且协议没有指定最大深度。在 uTorrent 客户端中，这个深度是通过使用一个整数作为位字段在内部跟踪的，本质上是将二进制 1 移位到这个整数中，用于每一级的字典解析。当超过 32 个字典被嵌套时，bencode 解码代码溢出整数。此溢出导致试图访问空指针，使客户端崩溃。

这种易受攻击的代码有两种不同的攻击方式。第一种是通过特制的 torrent 文件。这没什么意思，因为客户端在试图打开文件时会崩溃。有趣的媒介是通过同伴握手。恶意 bencode 数据可以作为握手的一部分发送，使另一端的客户端崩溃。这种能力非常有趣，因为它可以用于针对特定种子的定向 DoS 攻击。

有人指出，[一个流行的旧版本 uTorrent 没有这个确切的漏洞](https://www.reddit.com/r/netsec/comments/ixxtny/utorrent_cve20208437_null_deref_vulnerability_and/g69j35k?utm_source=share&utm_medium=web2x&context=3)，尽管关于运行过时软件的正常警告仍然适用。也有可能在其他 BitTorrent 客户端中发现类似的漏洞。

### 众包失败 2 班

如果你运行一个连接到互联网的服务，那么你可能对 fail2ban 有所了解。它是一个守护进程，监视系统日志中的重复事件，比如试图猜测 SSH 密码，并暂时拒绝猜测的 IP 地址。这是一个方便的工具，但是如果可以在许多系统上同时使用实时拒绝列表，那不是更好吗？Crowdsec 的目标是成为解决方案。一旦安装并选择加入，每个感兴趣的事件都被转换成一个由 IP、事件类型和时间戳组成的数据点，并上传到中央数据库。从那里，每个报告然后被折叠到不断发展的拒绝列表。这个项目还很年轻，但这可能是一个值得你关注的项目。

### 当一个密码破译者去(虚拟)赌场时

我们的老朋友，NCC 集团，瞄准了一个利基行业，在线赌博。具体来说，[他们看了看网上轮盘赌](https://research.nccgroup.com/2020/09/18/online-casino-roulette-a-guideline-for-penetration-testers-and-security-researchers/)，但是他们的技术却广泛适用。

要理解的第一个原则是，庄家永远是赢家。换句话说，赌博机构保证盈利。准确理解其工作原理可能很重要。在轮盘赌的情况下，这两种类型的赌注都稍微向房子方向堆叠。差距很小，即使是微小的优势也能扭转局面。因此，最简单的检查方法之一是随机数生成器。找到中奖号码的列表，看看有些号码实际上出现的频率是否更高。作者分享了一个小技巧:用位图图像表示数字。当数据以正确的方式显示时，人类的大脑特别擅长识别模式。

另一个可能的弱点是如何实现下注的结束。如果用户可以在浏览器中修改网站的 JS，他就可以比预期的时间晚发送赌注。如果服务器端不仔细检查这种攻击，后期下注可能会给玩家带来优势。整个文章充满了有趣的策略，既有一般的网络安全研究，也有赌博和轮盘赌的具体策略。

### 比特和字节

还记得微软 Active Directory 中拙劣的 AES 实现吗？美国网络安全和基础设施安全局(CISA)认为这是一个足够严重的风险，任何尚未打补丁的政府系统(截至 22 日)，[将永久与政府网络断开](https://cyber.dhs.gov/ed/20-04/)。

Drupal 刚刚发布了一个更新，解决了一个跨站点脚本(XSS)漏洞。XSS 攻击是指一个用户可以在网站中注入一些 JavaScript，当其他用户查看受影响的页面时，它就会运行。([Myspace 上的萨米蠕虫就是最好的例子。](https://en.wikipedia.org/wiki/Samy_(computer_worm)))目前没有太多额外的细节，但这个问题是在 Drupal 核心中，而不是在第三方插件中，因此影响可能相当广泛。去掸掉那些 Drupal 安装的灰尘，并更新它们！