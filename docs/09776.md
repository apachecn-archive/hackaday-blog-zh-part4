# 本周安全:脸书泄密、YouTube 泄密和文件类型混乱

> 原文:[https://hackaday . com/2021/04/09/this-week-in-security-the-Facebook-leak-the-YouTube-leak-and-file-type-confusion/](https://hackaday.com/2021/04/09/this-week-in-security-the-facebook-leak-the-youtube-leak-and-file-type-confusion/)

早在 2019 年更简单的时候，脸书就遇到了问题。大约有 5.33 亿个账户的手机号码被泄露。这是本周的安全新闻，因为这个数据库现在已经完全免费发布了。该数据集包括脸书身份证，手机号码，姓名，位置，生日，简历和电子邮件地址。[脸书指出](https://about.fb.com/news/2021/04/facts-on-news-reports-about-facebook-data/)这些数据不是黑客或漏洞，只是在 2019 年修复一个漏洞之前收集的。

该漏洞存在于脸书的联系人导入服务中，也称为“查找朋友”功能。简单的解释是，任何人都可以输入一个随机的电话号码，并获得一些关于声称拥有该号码的 FB 帐户的信息。问题是该服务的一些接口没有适当的速率限制功能。再加上脸书不断敦促每个人将手机号码与自己的账户联系起来，以及默认的隐私设置，让任何人都能通过你的手机号码找到你，数据搜集几乎是不可避免的。实际使用的技术可能是欺骗请求来自官方的脸书应用程序。

[Troy Hunt]的[when I be pwned 服务](https://haveibeenpwned.com/)已经集成了这个漏洞，现在允许通过电话号码进行搜索，所以去看看你是否是被暴露的人之一。如果你是，每次你不认识的人给你发邮件或打电话的时候，都要记住泄露的数据。

## 模仿电视

[David Schütz]在一个朋友家，拿出他的手机展示了一个私人 YouTube 视频。谷歌一直在努力使 Android/Chromecast/Android TV 无缝互联，该系统正在全力以赴。只需按下一个简单的按钮，他朋友的智能电视上就会播放私人视频，这似乎很容易。

作为背景，YouTube 视频可以存在三种状态。一个正常的视频展现在所有人面前，观看没有任何限制。未列出的视频不会显示在搜索结果或频道页面上。你必须有链接才能看到它。第三个选择是私人视频。这些对任何人都是不可见的，即使他们有直接的联系。要共享私人视频，查看者必须在允许查看者列表中。不在名单上？没有你的视频。那么，一台没有登录授权账户的智能电视是如何播放私人视频的呢？魔力是当用户启动该过程时生成的令牌。这个“ctt”令牌作为一个单一用途的认证器，允许电视播放用户的私人视频。

这是一个合理的系统，只要一切都安全地实施。剧透:事实并非如此。问题是跨站点请求伪造漏洞。这个神奇的令牌只有在用户从 YouTube 上请求时才会生成。因为这一意图没有被强制执行，所以只要视频 ID 已知，任何站点都可以请求令牌。“cast to TV”过程不仅适用于单个视频，还适用于播放列表，事实证明，每个 YouTube 帐户都有一个由每次上传组成的半隐藏播放列表。

攻击流程是这样的:受害者访问恶意网站，该网站发送用户“上传”播放列表的请求。因为受害者登录到 YouTube，并且请求来自他们的浏览器，所以请求被接受。一旦知道了视频 id，就可以为每个视频生成 ctt 令牌。这样，攻击者就可以访问受害者账户上的所有视频，甚至是私人视频。修复方法是实现适当的 CSRF 保护，并限制官方客户端对 API 的访问。下面的概念验证演示:

 [https://www.youtube.com/embed/HmdyzRH67ac?version=3&rel=1&showsearch=0&showinfo=1&iv_load_policy=1&fs=1&hl=en-US&autohide=2&wmode=transparent](https://www.youtube.com/embed/HmdyzRH67ac?version=3&rel=1&showsearch=0&showinfo=1&iv_load_policy=1&fs=1&hl=en-US&autohide=2&wmode=transparent)

T2】

## CRLF 访问私人网页

GitHub 提供的不仅仅是代码托管。他们还托管 GitHub 页面，其中一个功能是私人页面。您可以创建一个使用 GitHub 帐户作为授权的 web 界面。为您的组织设置不同的角色，您可以将页面限制为具有适当角色的用户。GitHub 对保证这些页面的安全非常感兴趣，所以私人页面是他们提供漏洞奖金的领域之一。

多亏了 COVID，【Robert Chen】度过了一个非常无聊的高三，[把寻找漏洞当成了一种爱好](https://robertchen.cc/blog/2021/04/03/github-pages-xss)。他开始关注 GitHub，并发现了一个怪癖。认证过程发送一个`page_id`值，该值被嵌入到响应中。他发现可以使用 url 编码在值中嵌入空格。身份验证过程会成功，但是结果页面包含空白。这通常意味着值由一个`toInt()`函数处理，但是原始的、用户生成的值被传递。更好的做法是将整数转换回字符串，并将其用作已知的可信值。

攻击者在 ID 中嵌入一个脚本标记，这样身份验证逻辑仍然可以成功，但是您拥有在受害者页面上运行的代码。这是通过一系列回车和换行符(CRLF)实现的，后面是一个编码的空值。`toInt()`函数一看到 null 就停止处理，但是有效载荷仍然被传递。下一步是利用不一致的大小写敏感性。该过程的一部分将“__HOST”和“__Host”视为相同。

谜题的最后一块是缓存中毒。GitHub 在认证流程中使用了缓存，如果没有上述问题，它会相当安全。缓存查找基于`toInt()`的结果，因此如果攻击者的恶意请求填充了缓存，每个访问者都有可能运行嵌入式脚本。他的研究为他净赚了 3.5 万美元，Github 在一个月内就解决了这些问题。

## 当 txt 文件是 HTML 时

操作系统如何决定如何处理给定的文件？主要的两种方法是文件扩展名和文件内容。有时，确切的反应是由两者的组合决定的。这可能很复杂，而且这种复杂性会引发安全问题。例证: [CVE-2019-8761](https://www.paulosyibelo.com/2021/04/this-man-thought-opening-txt-file-is.html) 。你可能会注意到，在《嵌入 CVE》的那一年，[保罗·伊贝罗]并没有急于出版他的作品。除此之外，这个 CVE 完全是关于 MacOS 如何处理包含 HTML 代码的`.txt`文件。

“文本编辑”是用于打开文本文稿的默认程序，但它支持粗体文本、不同的文本颜色等。简而言之，不仅仅是原始文本编辑。接下来的问题是,“文本编辑”能让你在多大程度上不受影响？相当多。如果该文本文件以`, TextEdit parses the HTML rather than letting the user edit it. It’s not quite broken enough to run JavaScript, but there are still some shenanigans to be had. Inside a pair of CSS tags, it’s possible to import an external style script. While that imported script is external to the `.txt`文件开始，它仍然局限于本地文件系统。这将是故事的结尾，我们最多能做一些恶作剧，比如让`/dev/urandom`死机。`

 `MacOS 有一个有趣的特性，叫做 AutoFS，它允许将远程位置自动挂载到本地文件系统上。这个特性不需要任何特殊权限，所以很容易从您控制的远程服务器中包含一个文件。这足够做一些有趣的事情了。[Paulos]无意中抛出了一个重磅炸弹:他还碰巧发现了一种方法，可以让一个网站自动下载一个`.txt`文件，并在没有任何用户交互的情况下打开它。有了这些知识，攻击者就可以在 TOR 服务器上托管一个简单的文本文件，并收集每个访问者的真实 IP 地址。

如果这还不够的话，一个不封闭的样式标签允许我们的流氓文本文件引用本地文件的内容作为请求的一部分。结果是，TextEdit 进程可以读取的任何文件也可以上传给攻击者。最终的 MacOS 怪癖使这变得更加有趣？Mac 的看门人是操作系统的一部分，试图阻止运行潜在的恶意代码，完全忽略了`txt`文件。[Paulos]在 2019 年私下向苹果报告了他的发现，他认为这个问题在 2019 年或 2020 年初得到了解决。

## 谷歌的艰难决定结束了一次行动

几周前，[有新闻披露了谷歌零计划所涵盖的一系列攻击](https://www.technologyreview.com/2021/03/26/1021318/google-security-shut-down-counter-terrorist-us-ally/)的幕后黑手。正在讨论的袭击是由西方政府发起的反恐行动。谷歌发现了这次攻击，对漏洞进行了逆向工程，并将其公之于众，但没有提供任何关于幕后主使的细节。这变得有争议，因为这个行动很可能在结果出来之前就结束了。它提出了一个有趣的问题:当一个研究人员发现一个漏洞被一个友好的政府利用时，他的责任是什么？当研究人员相信所讨论的行动的使命时，甚至？

谷歌似乎采取了一种盲目公正的方法。如果他们发现攻击正在发生，他们会以同样的方式回应，不管谁是幕后黑手。我怀疑这在一定程度上是基于这样一种假设，即如果谷歌已经检测到了攻击并对其进行了逆向工程，那么通常的嫌疑人也会检测到。如果他们坐在发现上，op 可能发生，但是来自不太友好的国家的 APT 团体也可能逆向工程和利用漏洞。你怎么看黑客日，如果一个友好的政府在背后利用漏洞，零项目应该坐以待毙吗？【编辑的附加问题:肩负保护本国公民互联网安全重任的“友好”政府应该坐视漏洞存在吗？如果“是”，凭什么失察？]让我们知道你对这个故事和下面的故事的看法吧！`