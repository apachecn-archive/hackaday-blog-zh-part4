# 本周安全:羊驼，AN0M，恢复赎金，等等

> 原文:[https://hack aday . com/2021/06/11/this-week-in-security-羊驼-an0m-recovering-ransoms-and-more/](https://hackaday.com/2021/06/11/this-week-in-security-alpaca-an0m-recovering-ransoms-and-more/)

我们来谈谈羊驼。更具体地说，“[应用层协议混乱——分析和缓解 tls 认证中的漏洞](https://alpaca-attack.com/)”。尽管这绝对是一个有人想把自己的名字拼成羊驼的例子，但这项研究本身相当聪明。

这是一种在 HTTPS 连接中进行中间人操作的方法，实际上不需要破解加密。攻击的核心有两个主要观察点。首先，多个子域通常会共享同一个 TLS 证书。其次，TLS 通常不仅仅用于保护 HTTPS。那么，如果一个 HTTPS 请求被重定向到同一家公司运行的 SFTP 服务器上会发生什么呢？TLS 握手将成功完成，但服务器返回的数据与浏览器预期的完全不同。

具体细节还不太清楚，但是作者确定了三大类攻击。第一种是上传攻击，攻击者拥有将文件上传到 FTPS 服务器的权限。据我所知，攻击者使用控制端口通过 SSL 发起 FTP 上传，然后将受害者的连接重定向到该服务器上的数据端口。然后，整个 HTML 请求在 FTPS 服务器上保存、解密。该请求可能包含会话 cookies 和其他机密。

第二种攻击与此相反，攻击者上传恶意文件，启动下载，然后将浏览器的请求重定向到 FTPS 数据端口。恶意文件被抓取，浏览器可能将其解释为要运行的代码。第三是反射技术。这个有点不同。本质上，攻击者发送一个对`DoBadThings();`的请求，然后将受害者浏览器连接到数据端口。响应被发送，
`Cannot find file: DoBadThings();`浏览器可能只是执行脚本片段。这不是那种适用于每台服务器的攻击，但在正确的设置下，它可能会导致问题。

## 被利用的 VMWare 缺陷

现在有一个严重的 [VMWare 漏洞正在被](https://arstechnica.com/gadgets/2021/06/under-exploit-vmware-vulnerability-with-severity-rating-of-9-8-out-of-10/)利用。它显然在 VMware vCenter 控制程序中，利用它就像六个`curl`命令一样简单。该漏洞是预验证漏洞，只需要访问 HTTPS 端口 443。至少有一名研究人员已经看到他的 VMware 蜜罐受到攻击，并观察到攻击者安装的 web 外壳。这看起来很重要，所以如果您运行 VMware，请确保您是最新的。

## 那次联邦调查局运行了一个暗网

AN0M 是地下世界流行的加密通信工具，实际上是一个由锁定的移动设备组成的网络，这些设备上运行着一个专门的应用程序。然而，现实有点不同，该工具实际上是作为伊隆塞德行动运行的，这是联邦调查局和澳大利亚联邦警察(AFP)的联合行动。这个故事很奇怪，确实引发了一些法律和伦理问题，所以系好安全带。

首先，事情要追溯到 2018 年，当时 [Phantom Secure 首席执行官文森特·拉莫斯(Vincent Ramos)被起诉 RICO 指控](https://www.theregister.com/2018/10/03/phone_ceo_pleads_guilty/)，与他的公司在安全手机方面的工作有关。他们专门拿走黑莓手机，拔掉所有 IO 硬件，比如摄像头、麦克风，甚至 GPS 芯片，然后安装加密通信应用程序。总之和 AN0M 很像。Phantom Secure 在成为安全硬件的合法提供商和积极支持犯罪企业之间徘徊。当拉莫斯告诉一名卧底的联邦调查局特工，他的手机专门用于毒品走私时，很明显他已经远远偏离了法律的错误一边。他和公司里的许多人被指控犯有相关罪行。

一名雇员的记录上已经有毒品指控，并同意与联邦调查局合作，以换取避免进一步的指控。那个开发者已经在开发他自己的设备，他称之为 AN0M。他和联邦调查局达成的协议是交出他的作品以获得豁免权。一个计划正在酝酿中，显然是在代理商之间的啤酒上，以完成 AN0M 的开发和分发设备，但包括一个完整的执法后门。这实际上非常类似于 Crypto AG 在 Rubicon 项目下所做的事情。

这位转行的开发者将这些设备分发给他的联系人，世界各地的执法机构也参与进来，悄悄地帮助它们普及。这些设备实现了向所有接收者发送消息的目的。只是当时还不知道执法人员会将每一封邮件都以密件方式寄出。尚不清楚是什么引发了突袭和公告，但这肯定是一次协调行动。

然而，有一个挥之不去的问题。也就是说，执法部门真的有开发和分发恶意设备和应用程序的合法权限吗？搜查令真的包括这个吗？可以吗？在接下来的几个月里，肯定会有很多人对这些问题感到惊愕。试想一下，WhatsApp 最终被揭露是中国政府秘密开发的 App，那你会作何感想？

## 勒索软件和比特币扣押

联邦调查局的另一个重大胜利是，殖民管道支付的大部分资金已经收回。目前还不完全清楚恢复是如何发生的，但你可以阅读描述比特币路径的联邦调查局宣誓书。那份文件的末尾有一个奇怪的小陈述。"主题地址的私人钥匙在加利福尼亚北部地区的联邦调查局手中。"人们不得不怀疑几件事。首先，联邦调查局是如何追踪这些比特币的？第二，它们怎么会出现在一个他们知道钥匙的钱包里？AN0M 的故事有关联吗？

> 主题地址的私人密钥在加州北区的联邦调查局手中

这是另一个角度。Colonial 可以选择用比特币或以太坊支付，他们选择了比特币，尽管该货币有 10%的额外费用。他们的网络大部分都是备份的，他们知道解密器不会有很大帮助。他们和执法部门合作，他们仍然付钱。这就提出了一个非常现实的可能性，即这笔款项是专门用来追踪比特币交易的。

接下来，还记得 JBS 对他们的事件响应有多自豪吗？现在我们发现他们确实支付了 1100 万美元的赎金。然而，这是与联邦官员合作，并没有必要恢复文件。哦，用比特币支付的。听起来熟悉吗？在这一点上，很有可能联邦调查局或其他机构在帮助他们追踪比特币交易。一个 0M 是一种可能性。另一个是，联邦调查局正在运行一个“混合器”，本质上是一种比特币洗钱服务。(对着@MalwareJake 大声喊出来。)无论如何，由于过去几周高调的黑客攻击，人们似乎对勒索软件采取了更严肃的态度。

## 火箭。聊天火爆

运行火箭。聊天实例？[去更新吧！](https://blog.sonarsource.com/nosql-injections-in-rocket-chat)这个流行的开源消息平台使用 NoSQL 后端来管理用户。如果您认为摆脱 SQL 意味着您没有注入漏洞，请再想一想。

MongoDB 数据库后端以类似 JSON 的格式传递请求和数据。第一种攻击是在 JSON 中填充一个正则表达式模式，一次泄漏一个字符密码散列。第二个漏洞巧妙的使用了 MongoDB 中的`$where`操作符。他们没有试图直接泄露信息，而是使用错误消息来获取信息。将两者结合在一起，您可以在几秒钟内从简单地知道用户的电子邮件地址变成托管服务器上的外壳。总而言之，这是一个令人印象深刻的黑客技术，它的视频演示值得一看:

 [https://www.youtube.com/embed/leuTzRVTICA?version=3&rel=1&showsearch=0&showinfo=1&iv_load_policy=1&fs=1&hl=en-US&autohide=2&wmode=transparent](https://www.youtube.com/embed/leuTzRVTICA?version=3&rel=1&showsearch=0&showinfo=1&iv_load_policy=1&fs=1&hl=en-US&autohide=2&wmode=transparent)

T2】

## 特工史密斯接管了矩阵

Include Security 在 Unity 引擎中发现了一个有趣的 bug，[恶意游戏对象可以在运行引擎的机器上运行任意代码](https://blog.includesecurity.com/2021/06/hacking-unity-games-malicious-unity-game-objects/)。这是那种游戏设计师不会过多考虑的事情，直到它成为一个问题。我不禁想到了 VR 聊天，一种允许玩家上传自己头像的多人游戏体验。它内置于 Unity 中，并为这些角色使用游戏对象。我还不能确定它是否有这样或那样的弱点，但我非常想起来特工史密斯把自己复制到矩阵的所有其他公民身上。如果 VR 聊天确实存在这个问题，那么构建一个头像蠕虫来做同样的事情就相当琐碎了。生活模仿艺术。

## 不用密码管理器？

最后，网络安全智慧中神圣的一点受到了谷歌零名声项目(Google project Zero fame)的[塔维斯·奥曼迪]的挑战。他拿的？[不要使用密码管理器](https://lock.cmpxchg8b.com/passmgrs.html)！嗯，实际上，你不应该使用一个作为浏览器扩展的密码管理器，因为网站实际上可以与让它们工作的钩子进行交互。他的论点还有更多，他的结论很简单。使用谷歌浏览器内置的密码管理器。或者火狐，如果你用的是这个的话。他的论点相当有说服力，其中许多并不像他们声称的那样安全。