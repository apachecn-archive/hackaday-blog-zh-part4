# 本周安全:零天，公证的恶意软件，绝地思维技巧，等等

> 原文：<https://hackaday.com/2020/09/04/this-week-in-security-zero-days-notarized-malware-jedi-mind-tricks-and-more/>

蜜罐是一种了解新攻击的有趣方式。一个模拟的易受攻击的系统暴露在互联网上，邀请任何人试图闯入它。而不是实际危及部署的设备，攻击者只是透露他们将如何攻击真实设备的信息。由[360 网络实验室运行的一个蜜罐在四月](https://blog.netlab.360.com/in-the-wild-qnap-nas-attacks-en/)发现了一些有趣的事情:针对 QNAP NAS 设备的 RCE 攻击。该漏洞是在注销端点中发现的，该端点获取外部值而不对其进行适当的净化。这些值被用作一个`snprintf`语句的一部分，然后通过一个`system()`调用来执行。因为没有任何清理，所以像分号这样的特殊字符可能会被注入到最终要运行的命令中，从而产生一个微不足道的 RCE。

QNAP 发布了新的固件，通过用`execv()`替换`system()`调用来解决这个问题。这一变化意味着 shell 不是执行过程的一部分，命令注入失去了它的作用。版本 4.3.3 是第一个包含此修复的固件版本，所以如果您运行 QNAP 设备，请务必检查固件版本。虽然这个漏洞在野外被利用，但似乎还没有广泛的利用它的运动。

## 公证的恶意软件

曾几何时，说 Mac 机没有病毒是相当准确的。严格地说，自从 1987 年发现 nVIR 在软盘上传播并感染 Macintosh 机器以来，这种情况就没有发生过。不管怎样，随着 MAC 电脑越来越受欢迎，随着微软慢慢提高了 Windows 系统的安全性，说 MAC 电脑没有感染病毒变得越来越不准确。作为回应，苹果推出了 macOS 的代码公证，这是一个开发者向苹果提交应用程序以供审查的系统。在应用程序被验证为无恶意后，它会用苹果的密钥进行签名，无需任何特殊步骤就可以在 Mac 电脑上运行。

问题在于，仅仅通过静态分析来确定一个程序是否是恶意的存在固有的困难。苹果似乎签署了几乎所有的请求，并简单地撤销了被证明是恶意的应用程序的签名。来自 Objective-See 的[Patrick Wardle]为我们带来了关于使用经过公证的恶意软件的活跃 Mac 恶意软件活动[的报告。这一情况被报告给了苹果公司，苹果公司很快撤销了这些签名。在 48 小时内，恶意软件运动再次证明了恶意二进制文件。这种情况将如何解决还有待观察，但目前看来，经过公证的代码似乎不是值得信任的代码的一个很好的指标。](https://objective-see.com/blog/blog_0x4E.html)

## 你不需要看我的身份证

非接触式支付令人印象深刻。只要在支付终端上刷一下信用卡，一个加密的握手就能确认你真的有这张信用卡。在大额交易的情况下，还需要 PIN。支持该标准的协议是 EMV，以合作开发该标准的欧洲卡、万事达卡和维萨卡命名。苏黎世联邦理工学院的研究人员查看了该协议，并发表了一篇关于他们发现的一些缺陷的论文(pdf) 。我发现最有趣的攻击是他们用一对手机作为媒介完成的“绝地思维把戏”。这种攻击是一个简单的中间人，在传输过程中会改变一些字节。这些字节指示支付终端不需要 PIN 输入，即使是非常大的购买。

## 小心编译秘密

安全之所以如此困难，是因为有太多的方式来破坏它。这一次，我们讨论的是编译成已发布软件的静态密钥。[【Abss】对 Android 安全性产生了好奇，并开始着手一个项目。](https://abss.me/posts/fcm-takeover/)他尽可能多地拿到 apk，并反编译它们。从那里，对变量和字符串的聪明的`grep`搜索产生了一堆有趣的结果，比如 Google API 键。

这一切都很好，但似乎应该有一些有趣的事情可以用收获的钥匙来做。答案是谷歌的 Firebase 云消息服务。一个有效的密钥 FCM 服务器密钥和一点布尔欺骗允许向应用程序的每个用户发送消息。不难想象，许多应用程序在编写时都假设传入的 FCM 消息是可信的。打破这种假设会导致各种各样的问题，包括谷歌四个官方应用中的 RCE。

## 思科 Jabber

Jabber 是一个信使服务，建立在 XMPP 之上。Cicso 提供了一个专有的 jabber，最近发现这个 jabber 容易受到严重的 RCE 攻击。该漏洞归结为一个跨站点脚本过滤器，它在黑名单模式下工作，并没有成功阻止它应该阻止的一切。可以通过发送带有`onanimationstart`属性的 img 元素来绕过过滤器。

因为该漏洞可以由一条消息触发，所以它也被认为是一个蠕虫漏洞，因此严重性为 9.9。这个问题是私下报告的，现在有一个更新版本可以修复，所以如果您的组织使用 Cisco Jabber，请确保它得到更新！

## 当代码回视时

如果在安全产品中发现漏洞是一种反常的乐趣，那么在漏洞扫描器中发现漏洞肯定是双倍的乐趣。这正是[Gabor Mutuz]发现自己正在做的事情——试图破解漏洞扫描器。尽管现代容器化的应用程序非常复杂，但有可能会被漏洞扫描器绊倒也就不足为奇了。

虽然这看起来像是无用的漏洞研究，但是考虑到一些项目将这些扫描器插入到他们的持续集成管道中。我见过一些项目甚至对每个拉取请求都运行 CI 检查。这不是通常考虑的攻击媒介，但非常重要的是，即使这些工具也经过了安全加固。[Gabor]报告了他发现的问题，这些问题已在后续更新中得到修复。一定要去看看他的帖子，了解所有的细节。