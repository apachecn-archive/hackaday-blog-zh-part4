# 黑掉堆叠中的另一个精灵

> 原文：<https://hackaday.com/2022/05/22/hack-another-elf-on-the-stack/>

[dropbear]最近发现自己陷入了困境。出于逆向工程的目的，在特定点从 Android 应用程序中转储一些数据。虽然它在模拟器中工作得很好，但在通过 lldb 的硬件上却非常慢。解决方案是给[写一个补丁，并把它应用到 ELF 文件](https://dropbear.sh/blog/elf-patching.html)中。

编写 AArch64 程序集来转储缓冲区相对来说比较简单，但是将它添加到现有的 ELF 中并重新打包到新的 APK 中会导致奇怪的错误。`.rodata`中的相对偏移现在都是错误的。对于那些不经常接触 ELF 文件格式的人，我们有一个[奇妙的资源带你进入黑暗的深处](https://hackaday.com/2020/05/28/peeking-inside-executables-and-libraries-to-make-debugging-easier/#more-412580)。但是快速总结的版本是，节包含各种资源，您可以通过相对偏移量找到这些资源的一部分。程序头描述了每个部分包含的资源类型。

[dropbear]发现了一个仅包含一些元数据的注释部分。她在自定义程序集的文件末尾创建了一个新的部分，并修改了文件头，将 NOTE 部分声明为指向新部分的 LOAD 部分，该部分将被映射到内存中。剩下要做的就是在实际代码中调整程序集，跳转到她转储的新代码。BSS 部分被扩展了几个字节，这样她的程序就可以在那里存储它的状态。

这是一项令人印象深刻的技术，她的修改程序头的程序在她的网站上有 BSD-3 许可。