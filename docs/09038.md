# 将 Firefox 移植到苹果芯片:来自战壕的故事

> 原文:[https://hack aday . com/2021/01/22/porting-Firefox-to-apple-silicon-tales-from-the-trench/](https://hackaday.com/2021/01/22/porting-firefox-to-apple-silicon-tales-from-the-trenches/)

对于任何旨在兼容苹果 MacOS 的更小或更大的软件产品来说，最近推出的基于 ARM 的苹果硅处理器和 MacBooks 有点令人震惊。突然，一个主要的桌面平台将改变处理器体系结构，并且很可能放弃和改变一些 API。在 Mozilla 总部，他们认为，根据过去的经验，苹果宣布“第一个苹果硅硬件”也意味着这些系统将可以出售。

事实上，在 11 月 10 日发布声明一周后，苹果确实这么做了。那时，Mozilla 已经努力确保 Firefox 代码库可以为苹果基于硅的 MacOS 构建。幸运的是，通过在 Windows-on-ARM 上运行 Firefox 的经验，他们已经获得了与 64 位 ARM 兼容的代码库。最终，这里最大的障碍是不成熟的 Rust 语言和对 Apple Silicon 的依赖支持，这阻碍了第一次发布。

当在基于 Intel 和 ARM 的 MAC 上发布 Firefox 时，决定将两个版本的应用程序打包成一个所谓的通用二进制文件。虽然这增加了安装程序的大小，但也意味着更容易分发，并且不会影响 Firefox 内置的更新程序。这也为谷歌 Widevine DRM 模块提供了一个简单的解决方案，最初没有苹果芯片版本可用，允许英特尔通过 MacOS 中的 Rosetta 2 二进制翻译器将同一模块用于任何一个 Firefox 版本(正如我们之前报道的)。

在此之后，它或多或少是一帆风顺的，一些基于 Rosetta 2 的故障和 MacOS Big Sur 相关的错误破坏了一些乐趣。这一经验表明，即使是像 Firefox 这样的大型代码库移植到苹果的新平台也是相当简单的，缺乏工具链和其他依赖关系的支持是最有可能出错的事情。

Rosetta 2 的特性虽然很有帮助，但正如 Firefox 开发人员发现的那样，它也有一些缺陷，当然，对于这样一个新平台，还可以(也应该)进行更多的优化。