# 在搅拌机中制作你的机器人动画

> 原文:[https://hack aday . com/2022/05/11/animate-your-robot-in-blender/](https://hackaday.com/2022/05/11/animate-your-robot-in-blender/)

你已经制造了一个塞满伺服系统的机器人，现在你可以开始享受有趣的部分了，为你的新跳舞的电子熊编程！你生命中的痛苦才刚刚开始。想象一下，你决定跳舞的熊应该举起它的手臂。如果您简单地设置一个伺服位置，电机将尽快回转到位。你需要的是一个动画，最好是平滑加速的。

你可以自己解决所有的数学问题。在摆弄了半个小时的数字后，这只熊优雅地举起了它的手臂，就像一只独臂僵尸。然后你意识到熊还有 34 个伺服系统。

![render of industrial robot type arm with pedestal, base, upperarm and lowerarm and IK ball](../Images/13acf41a6f86b4767428d816f51248d1.png)

幸运的是，对于做过以上事情的人来说，还有 Blender。这一切都是为了给动画和计算机图形创造流畅的动作。用搅拌机做机器人运动，如果不容易，至少是可以忍受的。我们制作了一个简单的项目，一个三轴机械臂来说明。它有一个不动的基座、旋转底座、上臂和下臂。我们将首先在 Blender 中制作动画，然后将文件翻译成我们可以用一点脚本来驱动伺服系统的东西。

现在，Blender 因为一个困难的用户界面而臭名昭著。好消息是，在 2.9 版本中，它转移到了一个更加正常的界面。它仍然肯定**是**一个大程序，有 23 个不同的编辑器和数以千计的控件，但我们将只使用一小部分来让我们的机器人移动。这里就不教你搅拌机了，因为网上有成千上万的很棒的搅拌机教程。你想专注于动画，特别推荐[人道索具系列](https://www.youtube.com/watch?v=3J-XN38EnhQ&list=PLE211C8C41F1AFBAB)。

以下是制作机器人动画的主要步骤:

1.  制作一个与你的机器人相匹配的“骨架”(骨架)
2.  装配骨架，使其像机器人一样移动，并且便于设置动画
3.  动画甲胄
4.  将伺服位置导出到机器人控制程序中

![4 bone armature. Bones are octahedrons with ball at head and tail](../Images/90ea23c45488ced856dbee75a23a0b45.png)

Robot Armature

通常，计算机动画由一个骨架和挂在骨架上的身体网格组成。对于机器人来说，我们不需要网格，只需要骨架，因为我们不是在拍电影。尽管如此，电枢**确实需要与硬件尺寸相匹配。导入 CAD 文件或在照片上构建，或者只是测量机器人。**

机器人的*静止姿态*是关节的参考位置，当轴在零时机器人在此位置。我们的方法是手臂向上伸直。

![robot pointing straight up](../Images/5d929a69935602e32b5d6427498c77d5.png)

Rest Pose

骨头绕着*尾巴*旋转，而*头*就是“它们所在的地方”。你胫骨的尾部是你的膝盖，胫骨的头部是你的脚踝。骨头可以有*父母*。你的胫骨是你大腿骨的子骨。如果你移动你的股骨，你的胫骨也会跟着移动。

骨骼只在特定的轴上旋转。膝盖只能前后摆动，不能左右摆动。你可以扭手腕，但不能扭指甲。它们也有运动限制。你可能不能向后弯曲你的膝盖。

铰链关节只能旋转，但一些骨骼可以缩放(软机器人)，或平移(CNC 路由器)。

还有更复杂的*约束*。客车的前轮一起转向。蒸汽机车上的连杆停留在它们的销上。这条狗可以在皮带的极限范围内自由活动。

动画师可能不想通过定位骨骼来设定姿势。通过设置角色的角度来激活他们的眼睛会很笨拙。最好有一个额外的目标骨骼，角色总是看着它，并限制眼睛看着目标。我们通常一次弯曲手指，一次弯曲一个手指上的所有关节。那么多一根骨头能同时控制一切呢？

带有所有这些额外控制骨骼和约束的骨架被称为*装备*。Blender 有强大的工具来建造这样的钻机。

我们例子的第一个骨骼，*基座，*代表机器人的基座，用螺栓固定在地板上的部分。骨骼是*可摆姿势的*——这就是关键，你可以给它们制作动画。但是这块骨头永远不会移动，所以我们锁定了所有东西——位置、旋转和比例。

![Blender interface n key properties showing all axes but Y rotation locked](../Images/335ea5556d939d70a47d53b4552d78ca.png)

基座在基座上旋转，因此*基座*骨骼是*基座*骨骼的子骨骼。*底座*的头部位于上臂的支点处。底座绕*底座*骨骼的 Y 轴旋转。这是唯一的运动，所以我们锁定了所有其他的轴。

其他骨头都差不多。 *upperarm* 是 *base* 的孩子，它的头在肘部。lowerarm 从肘部运行到手腕。这些关节定向为沿局部 z 旋转。

电枢现在可以工作了。选择*基座*(姿势模式)并转动它(Y 旋转),手臂骨骼也随之旋转。如果你在实验中弄乱了位置，只需撤销或设置解锁的轴为零。

我们的示例机器人有一个简单的网格，它随骨骼移动，因此您可以看到机器人移动。

但是仍然有可能把机器人放在硬件做不到的位置。假设我们的示例硬件机器人基座只能在中心的每一侧旋转 90 度。我们可以防止动画师用*骨骼约束*做出不可能的动作。我们给每个骨骼添加了一个*限制旋转约束*。

## 相互作用

这太棒了，但是现在我们想让我们的机器熊拿一份礼物。机器人将如何与外界互动。解决方法是*逆运动学(IK)* 。IK 让我们说我们想要手腕在哪里，而不是肩关节和肘关节在哪里。因此，我们在场景中添加了一个名为 IK 的球，并在 lowerarm 中添加了一个 IK 约束，以尝试够到球。

如果你跟着，移动样本时间轴到第 120 帧，这样 IK 就打开了，你就不会弄乱我们的动画。

机器人手腕现在正在“抓取”IK 球。在对象模式下，选择球并使用( **g 键**)来“抓取”它。拖动以移动球。机器人整齐地跟随，关节自动做需要做的事情。方便多了。

如果你想在 IK 约束中摸索，它的家是 *lowerarm* 。在姿势模式下，选择 lowerarm 和右侧对象属性编辑器中的骨骼约束选项卡。IK 约束位于此处。

Blender 的一个亮点是几乎任何东西都可以被动画化。大多数值的右边都有一个小白点。单击它会将它变成一个菱形，并使该值成为动画。我们这样做是为了“影响”，这是约束的“强度”。

## 动画时间

我们现在准备制作动画。对于大多数机器人来说，10 FPS 是很好的——在渲染属性中设置这个值。我们只是把所有的动画一个接一个地放在时间线中，并抓取我们想要的片段，所以也许“熊咯咯笑”是第 50 到 70 帧。

![Blender curves editor showing motion of IK ball](../Images/ee235592c3563f02c5d7247ef863fe2f.png)

IK ball motion. Black dots are keyframes.

当我们通过输入数字来移动熊的手臂时，我们必须完成每一帧。谢天谢地，现在不需要。我们只需要让机器人在足够多的帧上摆好姿势，就可以得到我们想要的行为。这些是*关键帧*。Blender 会处理中间的帧。

默认情况下，Blender 添加了缓入和缓出，因此伺服系统加速平稳。如果你想看到曲线，你可以选择 IK 球并检查“图形编辑器”。

*摆姿势*和*制作关键帧*是有区别的。*摆姿势*机器人不改变动画。只有*制作关键帧* ( **i key** )才能改变动画。

在第 50 到 75 帧中，机器人拿起某样东西并移动它。请注意，制作动画只是'移动球，制作关键帧'四次。制作整个动画不到两分钟。我们从未制作过真正的机器人——反向运动学替我们做了这件事。

从 90 到 105，机器人会避开附近的桌子，同时在上面放东西。实际上，我们必须在真正的机器人上运行这些程序，并对它们进行六次调整。在没有软件支持的情况下这样做将是一场噩梦。

## 从动画到机器人

我们已经准备好将动画转移到机器人控制程序中。对此有一个巧妙的方法。计算机动画文件的事实标准是“生物视觉分级”格式(bvh)。Blender 可以导出它，尽管你可能需要启用插件并选择骨架。这里有一个样本。

```
HIERARCHY
ROOT pedestal
{
        OFFSET 0.000000 0.000000 -1.000000
        CHANNELS 6 Xposition Yposition Zposition Xrotation Yrotation Zrotation
        JOINT base
        {
                OFFSET 0.000000 0.000000 1.000000
                CHANNELS 3 Xrotation Yrotation Zrotation
                JOINT upperarm
                {
                        OFFSET 0.000000 0.000000 0.500000
                        CHANNELS 3 Xrotation Yrotation Zrotation
                        JOINT lowerarm
                        {
                                OFFSET 0.000000 0.000000 3.100000
                                CHANNELS 3 Xrotation Yrotation Zrotation
                                End Site
                                {
                                        OFFSET 0.000000 0.000000 3.100000
                                }
                        }
                }
        }
}
MOTION
Frames: 251
Frame Time: 0.100000
0.000000 0.000000 -1.000000 -0.000000 0.000000 -0.000000 -0.000000 0.000000 -0.000000 -0.000000 0.000000 -0.000000 -0.000000 0.000000 -0.000000 
0.000000 0.000000 -1.000000 -0.000000 0.000000 -0.000000 -0.000000 0.000000 -0.000000 -0.000000 0.000000 -0.000000 -0.000000 0.000000 -0.000000 
0.000000 0.000000 -1.000000 -0.000000 0.000000 -0.000000 -0.000000 0.000000 -0.000000 -0.000000 0.000000 -0.000000 -0.000000 0.000000 -0.000000 
... lots of lines of this ...

```

虽然这看起来不太好解析，但是有一个技巧。我们不关心上面的部分(骨架)。我们只想要底层的运动数据帧。

找到“帧时间”之后的行的行号，对于我们的文件是 29，并使用`tail -n +29 ./robotarm.bvh | sed --expression='s/ $//g' | sed --expression='s/ /,/g' >robotarm.csv`获得每帧关节角度的 CSV 文件。

所有这些数字中哪个是什么伺服？我们如何将这些数字映射到发送给伺服系统的数字？

我们添加了一个动画(第 1-6 帧),按顺序练习每个自由轴——基础、上臂、下臂——到它的极限。如果我们查看 CSV 文件，其中的通道按此顺序变化，我们会发现通道 8 是 base，10 是 upperarm，13 是 lowerarm。如果您知道硬件极限处的伺服位置，您可以将一个映射到另一个。

实际数字是搅拌器关节位置的度数，所以剩下要做的就是每帧时间设置一次伺服系统，你的动画就会在现实中播放出来。

不要忘记，如果你一个接一个地播放动画，第二个动画需要从机器人离开的地方开始。并且记住，仅仅因为你要求一个伺服位置，你可能得不到。如果你知道你的机器人移动缓慢，要求敏捷的动作会失去位置控制。Blender 不知道。

最后，我们注意到“机器人”不一定是机器人。任何需要脚本动画的东西都可以这样处理。

当然，这并不是制造智能机器人助手的全部。还有其他任务，如视觉和抓取，需要实时控制，在飞行中调整运动，在固定动画之间平滑移动，在动画中放松和放松，以及混合动画。但是 Blender 和一个简单的导出程序可以让你开始。

制造机器人的一半乐趣是和它们一起玩。我们希望我们已经激发了你去看看 Blender，也许在这个过程中激发了一些电子动画。