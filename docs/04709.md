# 本周安全:零项目的 IPhone，BBC 的洋葱，生根机器人，等等

> 原文:[https://hackaday . com/2019/11/01/this-week-in-security-project-zeros-iphone-BBC-the-onion-root-androids-and-more/](https://hackaday.com/2019/11/01/this-week-in-security-project-zeros-iphone-bbc-the-onion-rooting-androids-and-more/)

始终有趣的 Project Zero 有两个围绕安全研究本身的故事。第一个，从本周开始，是关于一个人寻求制造一个用于研究的调试 iPhone。[Brandon Azad]想要 iOS 调试特性，比如单步执行、关闭某些缓解措施以及使用 LLDB 调试器。虽然苹果公司生产调试版 iPhones，但这些设备非常罕见，显然很难获得。

[Brandon]开始查看 iBoot 引导加载程序，但很快将注意力转移到 Arm 芯片组中的调试工具上。在可用的 XNU 源代码和公共 Arm 文档之间，他设法找到并访问了 CoreSight 调试寄存器，这使他一次可以单步控制一个内核。通过触发内核暂停，然后在复位期间中断该内核，他能够禁用代码执行保护，为他提供了他想要的一切。访问这个调试接口仍然需要一个内核级的漏洞，所以不要担心这项研究被恶意使用。

引起我注意的第二个 Google Zero 故事发表于本月早些时候，是关于在意想不到的地方找到有用信息的。即在旧版本的 Adobe Reader 中查找调试符号。当你只有一个反编译器输出时，试图理解一个正在运行的应用程序下发生了什么是一个挑战。Adobe 不提供 Reader 的调试版本，也从未在 Windows 上提供调试信息。Reader 已经存在了很长一段时间，这些年来已经支持了相当多的架构，令人惊讶的是，已经发布了相当多的调试版本。

古代的调试数据能有多大用处？请记住，Adobe 在不同版本之间的变化尽可能小。一些代码范例，比如枚举，也倾向于相当静态。其他元素可能会添加到枚举的末尾，但现有的值不太可能会改变。这篇文章的作者 Mateusz Jurczyk 随后向我们展示了一个例子，说明如何获取这些数据，并将其应用于找出车祸发生的原因。

### 噢，太好了！

这周我为一个客户解决了一个奇怪的问题。Chrome 突然开始显示“啊，啪！”每个访问过的网站的崩溃页面，包括 Chrome 设置页面。事实证明我并不孤单:[许多在 Windows 10 上使用 Chrome 78 的用户也看到了类似的问题](https://www.bleepingcomputer.com/news/google/how-to-fix-aw-snap-crash-in-google-chrome-78/)。事实证明，Chrome 78 是第一个支持渲染器代码完整性的版本，这是 Windows 10 的一项功能，旨在为网络浏览器带来额外的安全性。像 Symantec Endpoint Protection 这样的防病毒软件挂钩浏览器进程的方式也违反了完整性，这是防病毒行为的又一个例子，令人不安地类似于恶意软件行为。虽然赛门铁克已经发布了一个更新来纠正这个问题，但他们不是造成这个问题的唯一提供商，所以谷歌暂时收回了他们的 RCI 支持。

### 英国广播公司 Tor 频道

Tor，以前的洋葱路由器，是一个中继网络，提供了一种真正匿名访问互联网的方法。Tor 最有趣的元素之一是隐藏服务:通常是一个名称以“.”结尾的网站。洋葱”。最新的一款。洋葱服务是 BBC 的 T1，或者如果你连接到 Tor，你可以在 https://www.bbcnewsv2vjtpsuy.onion/news/technology-50150981 的 T2 T3 看到这个故事。我想谈谈 BBC 和洋葱，新闻讽刺的伟大堡垒，但看到 BBC 拥抱 Tor 真的很有趣。

目的是什么？Tor 不就是一个美化了的 VPN 服务，有[所有相同的潜在问题](https://www.youtube.com/watch?v=WVDQEoe6ZWY&t=0s)吗？不，Tor 有它自己独特的问题。Tor 的核心概念是嵌套公钥加密。每个数据包都有 3 层加密，这就导致了洋葱比较。该加密的包被发送到 Tor 入口节点，该节点执行第一层解密。这产生了双重加密的包和指向下一个节点的指针。入口节点将数据包发送到指示节点，指示节点解密下一层并将数据包转发到出口节点。出口节点对最后一层进行解密，得到一个未加密的数据包(例如，除非它是 HTTPS)和用户实际想要访问的外部服务的 IP 地址。入口节点只知道用户的 IP 地址和中间节点。中间节点只看到哪些节点充当入口和出口节点。出口节点知道目标服务的 IP，但是不知道用户的 IP 或位置。

虽然这确实提供了匿名性，但缺点是出口节点可以检查甚至试图修改所有流过的流量。最重要的是，许多出口节点在各种服务上被列入黑名单。还有一些针对 Tor 的实际攻击可以泄露用户。例如，当攻击者可以观察入口节点和出口节点的流量时，定时攻击可以暴露用户。

隐藏服务通过避免不可信的出口节点，至少避免了这些问题中的一些。相反，服务生成其公钥，该公钥用作。洋葱域名，然后将该数据上传到分布式哈希表(DHT ),由多个 Tor 节点存储。当用户试图连接到一个隐藏的服务时，他们从 DHT 中检索一个集合节点，连接可以完全在 Tor 内部进行，而不会暴露任何一方的身份。BBC 没有试图隐藏他们的身份，所以他们能够通过直接宣传他们的节点来使整个过程更快一些。用户仍然可以匿名连接，但是只需要 3 跳而不是 6 跳。

值得注意的是，BBC 网站的一些元素并不在 BBC.com 域名下，因此也不属于。洋葱服务。像广告和一些脚本这样的元素仍将通过出口节点加载。这不一定是个问题，但值得注意。英国广播公司已经做了额外的努力，建立了至少一个其他的秘密服务来反映他们的 bbci.co.uk 领域，以减轻至少一些这个问题。

### Nginx 揭示 PHP-FPM RCE

一个有点奇怪的 nginx 配置[揭示了 PHP-FPM](https://bugs.php.net/bug.php?id=78599) 中的一个 bug。指针算法是基于一个未经检查的假设完成的，因此可以操作数据结构。利用这一假设的关键是正则表达式不能正确处理作为 URL 一部分的换行符。URL 中的换行符导致变量为空，而该变量被认为永远不会为空。结果是对应于该数据结构的指针被破坏。对 URL 其余部分的小心操作意味着攻击者可以利用这种破坏直接以 PHP 代码的形式执行 URL 的一部分。

Nextcloud 配置文档中包含一个易受攻击的配置，因此如果您有一个使用 nginx 托管的 Nextcloud 实例，请务必检查该问题。

### Oneclick 安卓生根

最近的一个 Android 漏洞，一个免费后使用的 bug，[已经被打包成一个易于使用的根应用](https://www.zdnet.com/article/security-researcher-publishes-proof-of-concept-code-for-recent-android-zero-day/)。因为该漏洞存在于 Android 代码库本身，所以该漏洞适用于相当多的设备。这是一个释放后使用的漏洞，这意味着内存被释放，但一些代码试图访问该内存，好像它仍然有效。因为它已经被释放了，所以在它被访问之前，另一个进程可以写入这个内存位置。

虽然该漏洞存在于许多设备中，但[Grant Hernandez]警告不要在您的设备上盲目运行他的代码，因此选择不发布该漏洞的编译版本。虽然将代码编译成 APK 相对简单，但是裁剪漏洞以在您的设备上按预期工作需要更多的技能和知识。[Grant] [写了将漏洞转化为他的设备的完整根的过程](https://hernan.de/blog/2019/10/15/tailoring-cve-2019-2215-to-achieve-root/)，如果你对 Android 安全细节感兴趣，这值得一读。

### 租车和智能手机

一些新型汽车的卖点是能够将它们与智能手机应用程序连接起来。能够解锁你的汽车，启动引擎，甚至从远处跟踪它的位置，这是很有用的。当[一辆智能手机兼容的汽车被用作租车](https://arstechnica.com/information-technology/2019/10/five-months-after-returning-rental-car-man-still-has-remote-control/)时，会发生意想不到的后果。

[Masamba Sinclair]将他的租赁汽车连接到他的手机，并在租赁期间享受连接功能。他觉得很奇怪，几天后他发现他仍然可以通过应用程序访问车辆，即使别人已经租了这辆车。他给福特发了电子邮件和推文，但都无济于事。最后，在 Ars Technica 的文章发表后,《进取号》联系了他。几个月前，他终于失去了对自己租车的控制，但还有多少其他车辆处于同样的状态呢？

在租赁期之前*和之后*清除租车上的任何此类设置是一种很好的安全做法。仅仅通过将手机的蓝牙与信息娱乐系统配对，你就泄露了多少信息？可能比你想象的要多。