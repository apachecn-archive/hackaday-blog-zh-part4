# DSP 电子表格:混频

> 原文:[https://hack aday . com/2019/11/01/DSP-spread sheet-frequency-mixing/](https://hackaday.com/2019/11/01/dsp-spreadsheet-frequency-mixing/)

像 Matlab 和 Jupyter 这样的电路仿真和软件工作簿对于能够在没有大量开销的情况下构建东西来说是非常棒的。但是这些都有一些学习曲线，并且经常使用巧妙的技巧、抽象或库调用来掩盖真正发生的事情。有时在电子表格中建立数学模型会更清晰。

你可能认为电子表格不是用来计算频率和可视化的，但是你错了。这正是它们的用途——执行简单但重复的数学运算，并帮助理解结果。

在 DSP 电子表格系列的这一期中，我将讨论创建信号数学模型所需的两件简单而基本的事情:产生信号并混合它们。既然它无处不在，我就用 Google Sheets。大多数例子可以在任何电子表格上运行，但是至少每个人都可以共享一个 Google Sheets 文档。在这个过程中，我们将会看到一个我应该经常使用的简洁的电子表格技巧。

## 从结尾开始

[![](../Images/086e56bb503adbf291f83f5e31901a7f.png)T2】](https://hackaday.com/wp-content/uploads/2019/09/sheet.png)

这是最终电子表格的样子。有两个正弦波，我们将它们混合在一起得到一个正弦波，该正弦波将分解为输入的和及其差。这些都是实数——我们将在本系列的后面部分讨论复数。

你可能会认为混合两个信号就是将它们相加。结果是，频域中的加法看起来像时域中的乘法，所以我们实际上是想将两个信号相乘。一般来说，正弦波的一个好的数学模型是:`y=A*sin(ωt+Φ)`让我们分析一下这个方程，看看它是怎么回事。

正弦角度以弧度为单位，ω是频率，以弧度为单位。φ代表相移。因此，您可以将 A 视为幅度，比如说，如果 A 为 5，则输出将从-5 变为 5。频率告诉我们信号在一秒钟内会转多少个“整圈”。另一种说法是弧度每秒，我一会儿会深入解释。相移是指波与相移为 0 度的波偏移的距离(以弧度为单位)。当然，测试参数是以秒为单位时间。

## 弧度到底是什么？

[![](../Images/762a0eb44152dbc3f8396f17583a6d9a.png)](https://hackaday.com/wp-content/uploads/2019/09/radian.png) 如果你高中数学生疏，360 度就是`2π`弧度。在数学术语中，弧度与连接角的两端的弧有关。要计算弧度，测量圆弧的长度，然后除以圆的半径。如果圆弧是整个圆，那么圆弧的长度就是圆的周长——`2πr`——`2πr/r`就是`2π`。实际上，你通过乘以`π/180`将角度转换成弧度。对于频率，将每秒周期数(赫兹)乘以 2π。

如果你考虑一个正弦波，它实际上是在一个移动和旋转的圆上显示一个点。所以每个周期是 2π弧度。通过将赫兹频率乘以 2π，我们转换为弧度每秒。

请看这个图中的 90 度角。半径 R 是相同的，无论它在哪里接触绿色的弧。另一方面，圆弧是`2πR/4`(因为它是 90 度，或者一个整圆周长的 1/4)。然后当你计算弧度时，R 抵消掉，剩下π/2 弧度。弧度定义角度在任何圆上描绘的弧的大小，而不管该圆的实际大小。如果你算出来，π/4 是 45 度，π是 180 度，2π是一个整圆。

[![](../Images/e746d78444bc4a98433a054a2b8e11d8.png)](https://hackaday.com/wp-content/uploads/2019/09/chart.png) 其相也相似。180 度(π弧度)的相移将导致正弦波相对于零相移正弦波反转。π/2 偏移会使偏移正弦波的峰值与原始正弦波的过零点对齐。值得注意的是，正弦波的-90 度相移也称为余弦波。如下图所示，余弦波从 1 开始下降，而正弦波从 0 开始上升。

## 电子表格技巧

所有这些数学很容易在电子表格中设置。至少有两条路可以走。你可以做很多公式，或者你可以用一个技巧为每个信号做一个公式。不管怎样，你都需要一个时基。

这是我的[信号生成电子表格](https://docs.google.com/spreadsheets/d/1PBfqWA3uWog6UKmmMf9C6Mi0t5kdARIAyUKM0MsSpDg/edit?usp=sharing)。时基在 B 列，使用 A16 中的采样速率。单元格 B2 包含一个零。下一个单元格包含公式`B2+1/$A$16`,它在 A16 中找到费率的时间，并将其添加到 B2。美元符号意味着当我将它复制并粘贴到另一个单元格时，电子表格不会改变 A16 引用。事实上，把这个复制到 B3 单元格，你就得到`B3+1/$A$16`。

你也可以写一个类似于`(ROW()-1)*1/$A$16`的公式来做同样的事情，还有很多其他的方法可以达到同样的效果。无论哪种方式，很容易从一个单元格复制公式，然后从 B3 到 B1000 选择并粘贴。你的时间基础完成了。

您可以对信号列进行复制和粘贴，并创建要粘贴的公式。例如，细胞 C2 可以是:

```
$A$8*sin(2*pi()*$A$4*$B2+radians($A$12)
```

然后就可以一路抄下来了。然而，使用`ArrayFormula`是一种更聪明的方法。ArrayFormula 函数解释范围，并使用它们在公式下形成一个数组。这在示例中更容易看到。假设 B 列中有时基，出于某种原因，您想用 B2 乘以 B1，用 B3 乘以 B2，依此类推。你可以写:`ArrayFormula(B1:B10*B2*B11)`。你也可以使用标量，比如`ArrayFormula($A$4*B1:B10)`。

这允许您编写(更重要的是，编辑)一个填充整个数据数组的公式。如果你不喜欢处理单元格引用，另一个很好的特性是命名范围。如果您在“数据”菜单上选择“命名区域”,您可以像这样将 A4 命名为“频率 1 ”,然后在其他单元格中使用它来代替$A$4。

## 图形

真正的乐趣始于获得图形输出。电子表格通常擅长这样做，你可以从截图中看到，绘制两个正弦波图效果很好。将 E 列中的两者混合在一起，并用图形表示，这也很有说明性。

[![](../Images/b8fb36f601591aee890823e886633d03.png)](https://hackaday.com/2019/11/01/dsp-spreadsheet-frequency-mixing/c1/)

Generated input signals

[![](../Images/f413d9d68c7b66c91433044479673b83.png)](https://hackaday.com/2019/11/01/dsp-spreadsheet-frequency-mixing/c2/)

Mix of both signals

关键是不要试图一次绘制所有的数据。我的电子表格中的图表做了 200 点(400 毫秒)。使用折线图类型，然后您可以随意修改范围和标题等内容。查看 E 列可能不会告诉您太多信息，但该图显示了信号是如何很好地混合在一起的。

大约有 10 个高频周期，在 400mS 满量程时，计算出 25 Hz，即 10 和 15 Hz 输入之和。较大的较慢分量有两个完整周期，即 5 Hz，这就是你所期望的输入差。

您可以使用各种参数来查看它对两个图形的影响。有了这种数学模型，你可以开始处理其他信号处理的想法:滤波器，IQ 调制和解调，甚至更多。但是这些是另一篇文章的主题。