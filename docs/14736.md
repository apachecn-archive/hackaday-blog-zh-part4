# 本周安全:一键式、通用即插即用、大型机和探索迷雾

> 原文:[https://hackaday . com/2022/09/09/this-week-in-security-one-click-UPnP-mainframes-and-exploring-the-fog/](https://hackaday.com/2022/09/09/this-week-in-security-one-click-upnp-mainframes-and-exploring-the-fog/)

几周前，我们讨论了应用内浏览器，以及在浏览器中打开内容时潜在的隐私问题。本周，微软揭示了安全硬币的另一面——被访问网站[上的 JavaScript 可能能够与应用浏览器](https://www.microsoft.com/security/blog/2022/08/31/vulnerability-in-tiktok-android-app-could-lead-to-one-click-account-hijacking/)中嵌入的 JS 进行交互。漏洞链始于发布到 Android 的链接处理程序，其中任何`[https://m.tiktok[.]com/redirect](https://m.tiktok[.]com/redirect)`链接都会在抖音应用中自动打开。这里的问题是，这确实会触发重定向，而应用程序内部的深度链接不会被过滤掉。其中一个内部方案具有在应用 webview 中加载任意页面的效果，虽然有一个过滤器可以防止加载不受信任的主机，但它可以通过 URI 调用中包含的一对参数来绕过。

一旦加载了任意页面，最大的问题就出现了。在应用浏览器中运行的 JavaScript 向页面上运行的 JS 公开了 70 多个方法。如果这是不可信的代码，它就给出了王国的象征性密钥，因为当前用户可以访问 auth 令牌。账号修改，私密视频访问，视频上传都可以。值得庆幸的是，这个问题在三月份就被解决了，离私下披露还不到一个月。尽管如此，一键账户劫持是不容忽视的。谢天谢地，这个没有在修好之前从实验室里跑出来。

## UPnP 又罢工了

毫不夸张地说，通用即插即用(UPnP)可能是路由器中包含的最危险的功能，除了默认打开的 WiFi。QNAP 发布了又一个针对他们设备的勒索软件的公告，UPnP 再次成为罪魁祸首。Photo Station 是易受攻击的应用程序，它必须暴露在互联网上才能受到攻击。而 UPnP 是做什么的？在没有用户交互的情况下向互联网公开应用。QNAP 为了使他们的 NAS 产品更加可用，包括了 UPnP 支持，可能在某些型号上是默认的。如果您有 QNAP 设备(或者即使您没有)，请确保在您的路由器上禁用 UPnP，关闭所有端口转发，除非您完全确定您知道自己在做什么，并使用 Wireguard 进行远程访问。

## 复古黑客—IBM AS/400

[![](../Images/ceb1342c8be1301e1124d2852f781a61.png)](https://hackaday.com/wp-content/uploads/2022/09/IBM_AS-400_9406-730.jpg)

Viola Levan, CC BY-SA 4.0 , via Wikimedia Commons

如果你渴望一些复古的黑客技术，那么《无声信号》中的[【pz】已经满足了你的需求](https://blog.silentsignal.eu/2022/09/05/simple-ibm-i-as-400-hacking/)。虽然您不像以前那样经常在商店里看到 IBM AS/400 前端，但这些古老的机器仍然运行着许多企业的后端。IBM AS/400 解决了 IBM 在 80 年代早期面临的类似产品线过多的问题。它取代了 System/36 和 system/38 产品，并基于将 System/36 软件移植到 System/38 硬件的努力。新的解决方案使用技术独立的机器接口(TIMI)作为中间层，编译有针对性的程序。实际的操作系统在运行时翻译成物理处理器的机器代码，这就是 IBM 如何设法让这种旧软件运行这么长时间的原因。这类似于 Sun 试图用 Java 做的事情，尽管现代结果非常不同。

Silent Signal 的研究人员在 IBM AS/400(现在正式名称为 IBM i)中发现了大量尚未开发的研究成果。在这些系统上运行的许多代码都是在 80 年代末和 90 年代编写的，其中许多代码都进行了 Y2k 修复，并且很可能从那时起就没有被修改过。当时计算机安全研究的状态非常不同，所以可能会有问题需要发现。为此，他们建立了一个专门的 IBM i 实验室，并分享了一些发现。在一次针对真实客户的渗透测试中，他们获得了一个模拟 TN5250 终端和一个有限特权帐户的访问权限。TN5250 是敲门砖，因为 IBM 特定的终端协议支持像 Attn 这样的扩展键，Attn 作为系统中断键工作。被触发的菜单有一个漂亮的特性，作为登录用户打开一个 shell。一个微妙的错误配置允许以具有额外权限的其他用户身份运行命令。这种精确的渗透测试没有使用 IBM 代码中的漏洞，只是系统配置错误——但是随着真正了解这种遗留技术的系统管理员人数的减少，这可能会成为一个常见的问题。

## 8729 天大的 CVE

说到遗留代码库……看到我们现代机器中的一些代码有多旧总是有点令人吃惊。Curl 在 1998 年发布了 4.0 版本，在此之前它被称为 urlget。有当时写的代码仍然在项目中，[并且至少有一个漏洞](https://daniel.haxx.se/blog/2022/09/05/a-bug-that-was-23-years-old-or-not/)有点像。

Cookies 是网页可以存储在你的机器上的小块数据，由于一个善意但可怕的法律，你访问的每个新网站都会有这种东西。cookies 的历史有点复杂，因为它一直是一个没有正式设计或规范的临时解决方案。因此，即使在今天，我们仍然会看到一些奇怪的行为，比如一个子域可以为父域设置一个 cookie，而其他子域也可以看到这个 cookie。所以`[http://www.hackaday.com](http://www.hackaday.com)`可以用`domain=hackaday.com`设置一个 cookie。然后，如果你访问`someothersubdomain.hackaday.com`，cookie 会随请求一起发送。

Web 服务器已经存在了同样长的时间，但是已经被迫降低了它们的安全姿态。其中一个安全增强就是拒绝任何包含控制代码的 HTTP 请求，比如 0x07，ASCII 码。Cookies 对这些值没有固有的限制。将这些放在一起，就得到一个拒绝服务漏洞。子域可以设置一个包含控制代码的 cookie，分配给目标域，该 cookie 将在将来的任何请求中发送。这些请求会因为被捕获的 cookie 而被丢弃。cookie 处理代码是在 1998 年末添加的，并且这个技巧一直有效。只不过，浏览器在 2016 年增加了控制代码检查。这一定是一个量子效应，导致了一只虫子在同一时间有将近 24 岁和仅仅 6 岁。不管怎样，7.85.0 解决了这个问题。

## 生锈的 Tor

[![](../Images/b8a1fb45daff36de30fd63b2e46cfa23.png)T2】](https://hackaday.com/wp-content/uploads/2022/09/Arti.webp)

Tor 项目有一个~~闪亮~~ rusty 的新版本——[Arti，一个 Rust](https://blog.torproject.org/arti_100_released/) 中的 Tor 实现。这是由[Nick Mathewson]开始的一个宠物项目，但是在几个月之内，他就有了一个可以连接到 Tor 网络的代码库，并且很快就可以发送适当的匿名流量。一周前的今天，发布了 1.0.0 版本，标志着该项目已经准备好进入黄金时间。

还缺少一些东西，比如审查规避功能——将 Tor 流量伪装成其他东西的插件。另一方面，Arti 被用作对 Tor 进行一些改变和更新的机会，比如引入一个合适的 API。看起来最终的计划是放弃 C 实现，但是在 Arti 达到完全的特性对等之前，还有相当多的工作要做。

## EFF 进入雾中

EFF 正在瞄准 Fog Data Science，这家公司从移动应用程序供应商那里购买“匿名化”的位置数据，然后向执法部门出售一项服务，允许在这些数据中搜索个人。EFF 的研究人员完成了一项出色的探测工作，[对 Fog Reveal 搜索引擎进行逆向工程，但从未真正接触过界面](https://www.eff.org/deeplinks/2022/08/fog-revealed-guided-tour-how-cops-can-browse-your-location-data)。诀窍是访问 Fog Reveal web 应用程序，并获取站点访问时加载的所有 JavaScript 库。该应用程序需要一个帐户才能使用，但在浏览器中运行的所有代码都可以在没有登录的情况下使用。EFF 承担了对前端预期的数据进行逆向工程的非平凡任务，但最终它给了他们一个详细的外观。

结果令人印象深刻，也令人担忧。用户可以选择一个区域，给出日期和时间，并获得当时在该区域的设备列表。数据是匿名的——但是你可以选择一个数据流并跟踪用户。当你能找到一个普通的家庭住址时就不那么匿名了。一方面，我相信这在试图收集犯罪嫌疑人名单时非常方便，但这似乎不太可能接近人们可能认为的不合理的搜索或数据扣押。