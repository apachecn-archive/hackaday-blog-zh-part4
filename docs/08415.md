# 本周安全:可悲的 DNS，事件记录做得很好，TCL 回应

> 原文：<https://hackaday.com/2020/11/20/this-week-in-security-sad-dns-incident-documentation-done-well-and-tcl-responds/>

过去几天的一个大新闻是[DNS 缓存中毒](https://www.zdnet.com/article/dns-cache-poisoning-poised-for-a-comeback-sad-dns/)的回归。新的攻击[被命名为 SADDNS](https://dl.acm.org/doi/10.1145/3372297.3417280) ，而[完整的 PDF 白皮书](https://dl.acm.org/doi/pdf/10.1145/3372297.3417280)现在已经发布。当您在中毒缓存中查找网站的 IP 地址时，您会得到错误的 IP 地址。

这会把你送到恶意的地方，甚至更糟。该论文指出，DNS 已经遭受了某种功能蠕变，承担了越来越多的责任。我想到的最著名的 DNS 用法是 LetsEncrypt，它使用 DNS 作为证明域名所有权和颁发 HTTPS 证书的机制。

DNS 缓存中毒是一种相对古老的攻击，可以追溯到 1993 年。攻击的第一次迭代很简单。控制权威 DNS 服务器的攻击者可以包括额外的 DNS 结果，这些额外的结果将被缓存，就像它们来自权威服务器一样。1997 年，人们意识到已知的源端口与非随机事务 ID 的结合使得 DNS 数据包欺骗变得相当简单。攻击者只需在适当的时间用适当的`txID`欺骗 DNS 响应，让请求者认为它是有效的。没有 TCP 连接的额外保护，这是一个简单的任务。回应是在每个连接中随机化`txID`。

我不得不花点时间来谈谈统计学中我最喜欢的一个问题。生日悖论。随机选择的两个人同一天生日的几率是 365 分之一。有多少人必须在一个房间里才能有 50%的机会让两个人同一天过生日？如果你说 182，那么你就走进了悖论。答案是 23。为什么？因为我们不是在找一个具体的生日，我们只是在找日期之间的碰撞。每一个走进房间的不相配的生日都为下一个相配的生日提供了另一个机会。

这就是 DNS 生日攻击的本质。攻击者会发送大量 DNS 请求，然后立即发送大量欺骗性响应，猜测随机 txIDs。因为只需要一次冲突就可以得到中毒的缓存，所以成功的机会会迅速增加。缓解措施还随机化了 DNS 源端口，因此欺骗尝试必须在同一次尝试中拥有正确的源端口和 txID。

我们必须提到的另一个主要的 DNS 安全改进是 DNSSEC。DNS 安全扩展是建立在公钥加密基础上的 DNS 协议。实施 DNSSEC 后，缓存中毒和 DNS 欺骗基本上消失了。问题是这么多的解析器、转发器和域还不支持 DNSSEC。SADDNS 专门针对这些解析器和转发器。

SAD DNS 的真正关键是 DNS 端口的古怪之处，它允许端口扫描来识别给定 DNS 查询的发送端口。奇怪的是，当一个 UDP 包从一个给定的源端口发出时，操作系统认为该端口对输入的包是开放的。任何其他端口将返回 ICMP 退回消息，表明端口已关闭。这种技术与拒绝服务攻击相结合，给了攻击者足够的时间来识别源端口并发送一连串的 txID 猜测。因为他们可以在两步过程中找出端口和 txID，所以缓存中毒攻击再次变得可行。

对于这种攻击，有一种快速而简单的缓解方法，很容易实现。不要将防火墙设置为默认情况下拒绝数据包，而是设置为默认情况下丢弃数据包。这种变通办法是有可能克服的，但是如果目标 DNS 解析器/转发器被设置为默认丢弃未经请求的数据包，本文中描述的机制就不起作用。

## 如何记录违规行为

日本 Capcom 公司最近遭到勒索软件攻击。他们的网络究竟是如何被入侵的还不清楚，但是 [Capcom 非常清楚哪些数据被入侵](http://www.capcom.co.jp/ir/english/news/html/e201116.html?_pb_uid=1734)，哪些数据可能已经被入侵。事实上，他们的总体反应看起来就像一本教科书。他们给出了暴露的记录的类型和数量。此外，他们有意不在数据库中保存信用卡号等信息，因此这些信息不会被泄露。

他们在第四部分给出了详细的时间表。一旦发现攻击的结果，他们就拔掉服务器的插头，直接进入事件响应模式。由于这一快速行动，很可能攻击仍然很小。在事件发生后的两天内，他们发表了初步声明，确认这是一次袭击。更详细的报告将在两周后发布，这也相当快。如果您曾经处于不得不为攻击撰写公共事件摘要的尴尬境地，这可能是一个很好的参考，关于如何正确处理它。

## 美国英特尔公司(财富 500 强公司之一ˌ以生产 CPU 芯片著称)

[英特尔在 11 月](https://blogs.intel.com/technology/2020/11/ipas-security-advisories-for-november-2020/)发布了 40 个安全建议，总共披露了 95 个漏洞。正如上面的链接中提到的，这是很多。让我印象深刻的是，其中超过一半是由从事有偿安全研究的英特尔员工发现的。一些更有趣的漏洞被发现是[英特尔 AMT 管理平台](https://www.intel.com/content/www/us/en/security-center/advisory/intel-sa-00391.html)中的一对可远程利用的问题，以及[英特尔蓝牙产品](https://www.intel.com/content/www/us/en/security-center/advisory/intel-sa-00403.html)中的一个类似问题。虽然这些漏洞得到修复是件好事，但我还是希望看到更多关于这些漏洞到底发生了什么的信息。

## TCL 回应

还记得上周我们谈到 TCL 电视存在的问题吗？安全研究人员对这个问题最大的抱怨之一是 TCL 的沉默。沉默被打破了，相当多的问题得到了解答。我看过一些附加信息，其中 TCL 声明 TerminalManager 严格用于远程诊断，并且只能由最终用户激活。我们讨论的主要漏洞，即通过 HTTP 暴露的文件系统，是由一个单独的应用程序 T-Cast 引起的。该应用程序支持移动设备上的流媒体，但没有安装在北美的电视上。这似乎是该应用程序的一个意外副作用。

可能还会有更多，因为我们中有几个人正在钻研 TCL 电视和固件。然而，到目前为止，我的经验是固件组装得相对较好。在我购买的模型上，启用了 SELinux，根文件系统以只读方式挂载，没有安装 SU 二进制文件。有一些奇怪的事情，但是如果有任何事情发生，我们会在适当的时候告诉你们。

## 现代战争

还记得战争游戏吗？年轻的马修·布罗德里克只是想早点接触到电子游戏。他决定拨打洛杉矶的每一个电话号码，并记下哪些号码的另一端有计算机调制解调器，这样他就可以找到哪个号码属于他最喜欢的游戏开发商。我想[马丁·维戈]在做一个发现时一定是想到了这一点。许多服务允许您通过手机号码触发密码重置。通常，这个过程会泄露相关数字的几个数字。如果您可以针对多个服务协调查找，您可以从一个简单的电子邮件地址中恢复多个数字，甚至所有数字。

该工具的第二部分现在可用了:Phonerator。它从开源智能(OSINT)资源中获取有效电话号码的信息，并允许您从部分匹配中生成一个已知有效号码的列表。这里的“开源”不是指源代码，而是指公开可用的数据。Martin 建议了这些工具的一些巧妙用法。一种是反向查找跟踪者，假设你有一个与他们号码相关的电子邮件地址。这本书很有趣，尤其是如果你和我们一样是个电话迷。

## 本周最糟糕的主意？

最后，我们有了一个让我觉得是本周最糟糕的想法。在这篇博文中，[马修·格林]提出了一个简单的请求。他要求谷歌在他们的旧 DKIM 密钥过期后发布它们，并且可能更频繁地轮换这些密钥。首先，DKIM 是“域名密钥识别邮件”系统。这是确认声称的电子邮件发件人是实际发件人的简单方法。在 gmail 的情况下，谷歌用他们的秘密 DKIM 密钥签署每封发出的邮件，确认邮件确实是从声称的帐户发出的，并且没有被篡改。这个签名的目的是给管理员另一个反垃圾邮件的工具。

那么为什么马修希望谷歌发布这些密钥呢？谷歌 DKIM 最近被用来验证一些非常高调的电子邮件转储。他的论点是，如果任何人都可以访问签名密钥，被丢弃的电子邮件上的签名将不再可信。由于无法再证明它们是真实的，电子邮件黑客攻击将会放缓，不再是一个问题。

为什么这是个坏主意？因为它不会减少电子邮件黑客，只会让它不可能揭穿假的。如果有什么不同的话，给出签名密钥只会鼓励伪造的电子邮件转储。关于 DKIM 在执法和起诉的情况下是有用的，这里有一个单独的观点。在这种情况下，它不仅确认有效性，而且防止任何人篡改电子邮件。

编者按:我们并不都同意这一点。在加密算法中，可否认性通常被视为一件好事，因为它保护了隐私，并防止系统被用于这类勒索计划。如果你*想要*在你的电子邮件上签名，有很多方法可以做到: [GPG](https://gnupg.org/) 是最明显的。但是你不应该*非要*。用户不应该有这个基本的隐私选择，特别是默认模式侵犯了隐私。讨论！]