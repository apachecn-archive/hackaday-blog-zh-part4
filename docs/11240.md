# 本周安全:勒索软件解密、OpenSSL 和 USBGadget 欺骗

> 原文：<https://hackaday.com/2021/09/03/this-week-in-security-ransomware-decryption-openssl-and-usbgadget-spoofing/>

我们在这里已经讨论了很多勒索软件，但是我们没有花很多时间来研究受害者可以使用的解密器工具。当勒索软件团伙放弃或改变名称时，他们中的一些人会为尚未付款的受害者发布一种解密工具。不过，运行这些解密器并不是一个好主意。毕竟，出版商在保护你的数据方面没有良好的记录。当解密器真的发布了，并被证实可以工作时，安全研究人员将对该工具进行逆向工程，并发布一个已知良好的解密程序。

“不再勒索赎金”的好人们正在带头发起冲锋，制造这样的工具，并托管一批这样的工具。他们还提供 Crypto Sheriff，这是一种识别哪个勒索软件获取了你的文件的工具。上传几个加密文件，它会告诉你到底在处理什么，以及是否有可用的解密器。该网站是荷兰警方、国际刑警组织、卡巴斯基和迈克菲的合作项目。你可能会惊讶地知道，他们建议向当局报告每一个勒索案件。我可以证实，至少美国联邦调查局对跟踪各种勒索软件攻击非常感兴趣——我接到了一名跟踪感染的代理人的突然电话。

## OpenSSL

OpenSSL 项目在 1.1.11l 版本中[修复了一对漏洞](https://www.openssl.org/news/vulnerabilities.html)，CVE-2021-3711 和 CVE-2021-3712，第一个是[一个幼稚的长度计算函数](https://github.com/openssl/openssl/commit/59f5e75f3bced8fc0e130d72a3f582cf7b480b46)可能导致的缓冲区溢出。“固定”长度的报头实际上是动态的，因此精心制作的明文可能会溢出分配的缓冲区。

第二个漏洞没那么严重，但更有趣。这是在 OpenSSL 中,`ASN1_STRING`结构的形式规范和该结构的实际使用方式之间的不匹配。该结构包含一个字节数组和一个长度。问题是这个数组是否是空终止的。在几乎所有的 OpenSSL 代码中，这被视为标准的 C 字符串，但是文档中没有强制使用空终止符。当程序使用 OpenSSL 库并在本地构造 ASN 字符串时，真正的问题就来了。严格遵循文档会导致一个未终结的数组。当 OpenSSL 作用于该值时，它使用`printf()`和`%s`占位符将该信息打印到日志中，这将一直打印字符，直到遇到下一个空字符。这可能会泄露各种意想不到的信息。

## 大西洋汇流易受攻击

Confluence 是一个知识管理平台，本质上是一个面向企业的花哨的 wiki。他们刚刚修补了最近四个主要发布版本中存在的一个漏洞。CVE-2021-26084 是严重程度为 9.8 的 OGNL 注射问题。攻击者可以滥用该漏洞在底层服务器上执行代码，在某些情况下甚至未经身份验证。

OGNL 是对象图导航语言，被描述为 Java 的表达式语言。注入问题非常类似于 SQL 注入攻击，用户提供的数据可以包含表达式。OGNL 注射液通常看起来像`${(#rt = @java.lang.Runtime@getRuntime(),#rt.exec("calc.exe"))}`。

## 聪明的 Girl^H^H^H^HHacker

还记得插入 Razer 鼠标时对系统的权限提升吗？那次攻击最难的部分是，你必须将 Razer 或 SteelSeries 设备带到你想要入侵的计算机上。不再是了。如果你的 Android 手机上有 root，你现在可以使用`[usbgadget-tool](https://github.com/tothi/usbgadget-tool)`来欺骗正确的硬件。这两个特定设备使用的驱动程序可能会很快得到修复，但肯定会有相当多的类似情况，普遍滥用。

这是一个特别容易实现的漏洞，您可能会尝试在工作计算机上或类似的情况下使用它。这是你的定期提醒，插入 Razer 鼠标是一种犯罪——如果你这样做是为了在未经允许的情况下获得系统。用波斯尼亚比尔不朽的话来说，“保持安全，保持合法。”

## 本田的可破解钥匙

自 1995 年以来，滚动密钥一直在使用。递增计数器用作加密密钥的一部分，并在车辆和密钥卡之间保持同步。这种安排使得重放攻击更加困难，因为它允许车辆忽略用先前使用的计数器值签名的消息。已经有一些针对这个系统的非常聪明的攻击，比如捕获一条信息，同时干扰它，使车辆接收不到它。这不是那种聪明的黑客。[这看起来真的像一个部署在野外的坏系统](https://hackaday.com/2021/08/30/hacker-claims-honda-and-acura-vehicles-vulnerable-to-simple-replay-attack/)。

[Blake Berry]正在编写一个简单的脚本来突出两个字符串中的不同位，并在发送给本田汽车的一对钥匙链捕获上进行测试。这两根弦[非常相似](https://github.com/HackingIntoYourHeart/Unoriginal-Rice-Patty)。经过进一步的工作，发现捕获的锁定命令可以通过翻转一些特定的位来重放，并且车辆可以解锁。袭击已被证实发生在一辆早在 2009 年的汽车上，以及一辆 2020 年的车型上。似乎本田/讴歌根本没有在他们的密钥卡系统中做任何有效的加密。这一问题已被分配给 [CVE-2019-20626](https://nvd.nist.gov/vuln/detail/CVE-2019-20626) ，这使得 2020 年模型中存在的缺陷特别明显。

(编者注:我们最初对此持怀疑态度，因为这太*明显了，我们将在这里注意到，CVE 目前正在“进行再分析”。如果我们有一辆本田，我们会在午饭前测试一下。你能吗？让我们知道。)*

## 通过 DNS 接管子域

子域接管是指授权方可以在子域所指的 IP 上运行任意服务。有几种方法可以做到这一点，比如删除一个 GitHub Pages 网站，但保持 DNS 运行。其他人可以出现并声称相同的名称，然后在那个子域上托管他们自己的内容。有另一种方法来实现这一点，通过托管 DNS，并且有一种新的工具来找到易受攻击的域。 DNSTake 允许您指定一个域，它将沿着 DNS 链向上寻找域名服务器，寻找奇怪的 DNS 状态响应。

目标是找到一个使用托管 DNS 提供商的域，其中该域在该提供商的界面中已被删除，但 NS 记录仍然存在。对于许多这样的提供商，任何人都可以为无人认领的域名添加 DNS 记录。一旦攻击者控制了一个子域，就有可能造成相当大范围的损害。