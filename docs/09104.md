# 本周安全:Sudo、数据库漏洞和勒索软件

> 原文:[https://hack aday . com/2021/01/29/this-week-in-security-sudo-database-breakes-and-ransomware/](https://hackaday.com/2021/01/29/this-week-in-security-sudo-database-breaches-and-ransomware/)

[![We couldn't resist, OK?](../Images/5e9d2351b6036131eee7c6498c28400a.png)](https://hackaday.com/wp-content/uploads/2021/01/sandwich.png)

Obligatory [XKCD](https://xkcd.com/149/)

Sudo 是超级重要的 Linux 工具，也是无尽笑话的来源。可不是闹着玩的是 [CVE-2021-3156](https://blog.qualys.com/vulnerabilities-research/2021/01/26/cve-2021-3156-heap-based-buffer-overflow-in-sudo-baron-samedit) ，一个围绕转义字符处理不正确的严重漏洞。这个 bug 是 Qualys 的研究人员发现的，自 2011 年以来一直在 sudo 代码库中。如果你已经几天没有更新你的 Linux 机器了，你很可能还在运行易受攻击的 sudo 二进制文件。有一个简单的一行程序来测试漏洞:

`sudoedit -s '\' `perl -e 'print "A" x 65536'``

为了响应这个命令，我的机器抛出了这个错误，这意味着它容易受到攻击:

`malloc(): corrupted top size
Aborted (core dumped)`

为了理解 sudo 的问题，我们必须理解转义字符。它实际上归结为文件和文件夹名称中的空格，以及如何处理它们。你想把你的文件夹命名为“我的东西”？这很好，但是当空格是参数之间的默认分隔符时，如何在命令行上与该目录名交互呢？一种选择是用引号将它括起来，但这很快就过时了。Unix 解决方案是使用反斜杠字符作为转义字符。因此你可以把你的文件夹称为`My\ Stuff`。shell 看到了转义字符，并知道将空格解释为文件夹名称的一部分，而不是参数分隔符。转义字符是一个常见的漏洞位置，因为有很多边缘情况。

[须藤也不例外](https://www.sudo.ws/alerts/unescape_overflow.html)。这里的边缘案例是第二个 bug。`sudoedit`命令在编辑器模式下启动 sudo，它相当于`sudo -e`。事实上，在许多系统中，sudoedit 是 sudo 的符号链接。问题出在命令行解析代码中。如果您试图用-e 和-s 标志调用`sudo`,它会将该命令视为无效，并打印出使用说明。然而，当使用`sudoedit`启动编辑器模式时，也可以指定-s 标志，将 sudo 置于一个非预期的状态，具有未定义的行为。在检查了这个漏洞之后，我确信这是两个错误中比较严重的一个。由于能够将 sudo 同时置于两种操作模式中，很可能会发现很多其他漏洞。

另一个问题是 sudo 如何处理一个没有后续字符要转义的转义字符。代码跳过空字符串结尾，继续复制字符。在正常的使用模式下，这段代码不可能以这种奇怪的方式执行，但是由于奇怪的双模式状态，这个 bug 可以被利用。

sudo 的更新版本已经在主要发行版中发布，所以请务必更新！令人欣慰的是，虽然有一个概念验证的一行程序会使 sudo 崩溃，但没有实际的利用代码被公布。不过，很快可能会有完整的漏洞利用概念验证。

### 加载网页，获得 iPwned

苹果[发布了一条建议](https://support.apple.com/en-us/HT212146),内容似乎是在野外发现的针对 iOS 平台的攻击链。这个链由三个 CVE 组成，两个在 webkit 中，一个在内核中。这可能是另一个国家支持的行动者的工作，他将攻击链放在一起，收集特定人群的信息。这两个 webkit CVEs 可能是一个初始 RCE 和一个沙盒转义。然后，内核漏洞被用来提升系统权限并运行间谍软件。通常看到这些恶意软件包只在内存中运行，而不会对设备的操作系统进行任何永久性的修改。如果故事的其余部分被公开，我们可以回来检查我的猜测的准确性。

### 巴西泄露整个纳税人数据库

就原始大小而言，这可能不是最大的数据库泄漏，但这肯定创下了人均记录。巴西的一个政府机构似乎让他们的数据库逃脱了(葡萄牙语的)T1，因为多达 2 . 2 亿条关于中央公积金号码、全名和出生日期的记录在互联网上传播。这可能是每一个活着的巴西公民的身份信息，甚至是一些已经不在我们身边的人，因为他们的官方人口只有 2.13 亿。虽然有针对性的网络钓鱼和欺诈的直接用途是显而易见的，但公布相当于每个人的社会安全号码的长期影响将是有趣的。

为了不被超越，约会网站[meet minded 也泄露了他们的整个用户数据库](https://www.zdnet.com/article/hacker-leaks-data-of-2-28-million-dating-site-users/)。如果对该网站的用户来说有什么好消息的话，那就是没有私人信息或图片被泄露。

### 鸽子猫。等等什么？

最近，Synology 用户和 QNAP 用户都发现了一个`dovecat`进程将他们的设备处理器锁定在 100%。这个奇怪的过程是什么，笨拙地试图看起来像一个无辜的邮件守护进程？

谢天谢地，马修·鲁菲尔已经对这个恶意软件进行了分析。Dovecat 只不过是开源的 XMRig crypto miner，带有一些硬编码配置。很有可能任何有 dovecat 进程的系统上也有“hy4”恶意软件。这个小型加密挖掘恶意软件活动最吸引人的地方可能是，它似乎是针对 NAS 设备的。或者，它可能只是针对使用弱密码的 SSH 服务器。

### NetWalker 关闭

右边的图片引起了我的注意，因为像这样成功拿下 TOR 页面的例子屈指可数。[网络漫步者的基础设施已经被查封](https://www.justice.gov/opa/pr/department-justice-launches-global-action-against-netwalker-ransomware)，连同超过 45 万美元的加密货币。作为行动的一部分，一名加拿大公民被逮捕。

克雷布斯报道了这个故事的更多细节。NetWalker 是一个勒索软件系统，一直被称为“勒索软件即服务”。这条特别的蛇的头是否被切掉，或者它是一条九头蛇，并且会马上重新冒出来，还有待观察。

### 零头

VLC 发布了 3.0.12 版本。大部分的变更日志是正常的错误修复，支持苹果设计的处理器是突出的新功能，请注意，这个版本也修复了“一些安全问题”。这些可能是什么问题？虽然我们没有详细说明，但安全公告指出了一对缓冲区溢出和一些无效指针被取消引用。很明显，这些漏洞可能被用来构建一个漏洞，在观看视频时触发。

[IObit 论坛最近被攻破](https://www.bleepingcomputer.com/news/security/iobit-forums-hacked-to-spread-ransomware-to-its-members/)，用户数据库被用来传播勒索软件。为了让整个方案看起来更加合法，攻击者在受损站点上安装了恶意安装程序。这是故事发生幽默转折的地方。赎金过程也是一个加密货币庞氏骗局！你寄给我们 200 个 DERO 硬币来解密你的文件，一旦 DERO 达到 100 美元一个硬币，我们会送你价值 500 美元的硬币。这是你投资的 5X 回报！

Drupal 刚刚发布了一个更新，修复了一个潜在的严重漏洞。Drupal core 中使用的`Archive_Tar`库包含一个目录遍历漏洞，CVE-2020-36193。这通常意味着，即使一个归档文件被解压缩到一个安全的目录中，它也可能覆盖服务器上其他地方的重要文件。无论如何，Drupal 认为这是一个关键问题，并建议立即更新。