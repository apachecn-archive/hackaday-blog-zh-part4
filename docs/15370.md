# 用 Commodore 64 生成双因素认证码

> 原文:[https://hack aday . com/2022/11/14/generating-two-factor-authentic ation-codes-with-a-commodore-64/](https://hackaday.com/2022/11/14/generating-two-factor-authentication-codes-with-a-commodore-64/)

如果你在过去 15 年左右的时间里使用过企业 VPN 或网上银行系统，很可能你已经有了几个这样的认证密钥，仍然每 30 秒显示一个新代码。今天，这种一次性代码通常通过短信发送给你，或者由专用的智能手机应用程序生成，这很方便，但有点无聊。如果你错过了为你的登录代码准备一个专用硬件的机会，那么我们有好消息要告诉你:[卡梅隆·凯泽]已经成功地将一个 SX-64 准将变成了一个双因素认证器。与钥匙链不同，钥匙链是一个你不太可能丢失的小玩意，任何小偷都可能需要花相当多的时间来弄清楚如何操作它。

如果你不熟悉的话，SX-64 是古老的准将 64 的便携版。它的重量超过 10 公斤，不太像 MacBook Air，但它配有内置彩色显示器和 5.25 英寸软盘驱动器。CPU 是一个运行在 1 MHz 左右的 8 位 6510，正如你可能想象的那样，在它上面实现加密例程不是一项简单的任务。直接从 RFC 6238 中的定义开始工作，【Cameron】首先确定了所有必要的部分:一个 SHA-1 散列器、一个 HMAC 生成器和几个处理日期和时间的例程。

SHA-1 算法和 HMAC 函数可能看起来很复杂，但最终它们归结为对 32 位数字执行加法、减法和几个按位逻辑函数。如果你一次只能处理 8 位，那么需要很多步骤，但没有什么是 6510 在合理的时间内做不到的，尤其是在运行精心手工制作的汇编代码时。

处理日期和时间变得更加复杂。Commodore 64 系列的几个实时时钟插件都以人类可读的格式直接返回时间:非常适合日常使用，但对于需要 Unix 时间的计算就不那么好了。两者之间的转换涉及大量的乘法和除法，如果没有硬件乘法器，这将花费很长时间。[Cameron]的博客文章详细介绍了如何在受限硬件上优化计算，即使你使用的是现代处理器，这也是一篇有趣的文章。

这个练习的最终结果看起来几乎和你智能手机上的一个典型认证应用一模一样，包括那个烦人的倒计时条。如果你正在寻找一个稍微紧凑一点的解决方案，[你可以在 ESP32](https://hackaday.com/2018/01/04/two-factor-authentication-with-the-esp8266/) 上做同样的事情。需要复习双因素身份认证技术吗？[我们已经为你准备好了](https://hackaday.com/2017/10/16/inside-two-factor-authentication-apps/)。