# 本周安全:XCode 感染、Freepik 和 Crypto 失败

> 原文：<https://hackaday.com/2020/08/28/this-week-in-security-xcode-infections-freepik-and-crypto-fails/>

有一个场景让安全专家们夜不能寐:恶意软件可以检测软件编译并将其自身插入到生成的二进制文件中。一个新的 Mac 恶意软件 XCSSET ( [PDF](https://documents.trendmicro.com/assets/pdf/XCSSET_Technical_Brief.pdf) )就是这么做的，只要 Xcode 被用来构建应用程序，它就会运行。编译后的应用程序不仅有恶意的危险，恶意软件还会从开发者的机器上收集数据。似乎恶意软件通过受感染的 Xcode 项目传播。

## WordPress 插件

WordPress 有着复杂的安全记录。多年来，核心项目很少出现严重的漏洞。另一方面，WordPress 网站经常受到攻击。怎么会？一般通过易受攻击的插件。恰当的例子？[高级访问管理器](https://www.wordfence.com/blog/2020/08/high-severity-vulnerability-patched-in-advanced-access-manager/)。这是一个第三方 WordPress 插件，估计有 100，000 次安装。问题是这个插件需要用户级别，这是一个已被弃用和移除的 WordPress 特性。缺失的特性产生了一些意想不到的结果，比如允许任何用户请求管理员权限。

这个问题已经在插件的 6.6.2 中修复了，所以如果你碰巧运行了高级访问管理器插件，请确保更新它。除此之外，也许是时候对你的 WordPress 网站进行审计了。卸载未使用的插件，并确保其他插件以及 WordPress 安装本身都是最新的。

## 弗里皮克

作为图片和库存照片的来源，Freepik 免费提供一些图片，并要求每月订阅才能访问图书馆的其余部分。前几天，有人发现图标网站遭到 SQL 注入攻击，[用户数据库被抢](https://www.freepik.com/blog/statement-on-security-incident-at-freepik-company/)。关于他们的报告，有几件事引起了我的兴趣。首先，该报告声称，唯一逃脱的数据是电子邮件地址，在某些情况下，密码散列。不清楚为什么地址和信用卡信息没有被泄露。

下一个有趣的小消息是，任何使用联合登录的帐户，即使用脸书、Twitter 或 Google 帐户登录，都只暴露了一个电子邮件地址。回想起来，使用单点登录有一个明显的优势。该服务丢失关于帐户的信息要少得多。另一点有趣的是，一些旧帐户仍然使用 salted MD5 密码散列，而绝大多数使用更现代的 bcrypt。

## 克服漏洞利用缓解措施

Crowdstrike 发布了[两篇](https://www.crowdstrike.com/blog/state-of-exploit-development-part-1/)关于操作系统加固技术现状以及如何克服它们的[博客文章](https://www.crowdstrike.com/blog/state-of-exploit-development-part-2/)。数据执行保护和地址空间布局随机化在这一点上被认为是遗留技术，所以请查看该系列以了解最新信息。

## 让我们来谈谈密码

密码的第一条规则是什么？“不要推出自己的密码。”这到底是什么意思，为什么？我们有[一个关于加密如何出错的案例研究](https://brycx.github.io/2020/08/22/a-look-at-a-branca-implementation.html)，以及一些关于如何正确加密的提示。这个项目是布兰卡令牌(T4)的一个实现，这本身就是一个有趣的协议。

关于开发你自己的密码的警告通常意味着你应该使用已经被时间和同行评审证明的公开的算法。多年来，AES 一直有比你我更聪明的人在寻找缺陷。很可能这是一个比我们能想到的任何东西都好的分组密码。然而，这个警告并不意味着你不应该构建任何与密码相关的东西。如果没有一个库可以满足你的项目需求，那就去做吧，从头开始构建它。但采取一些预防措施，让自己远离麻烦。

测试向量是使用特定设置运行算法的公开结果。如果用某个密钥和某个输入文本运行 AES，每次都会得到一个已知的密文。一组好的测试向量将包括可能的边缘情况，比如明文的空字符串。找到您正在使用的加密的测试向量，并确保您的项目复制它们。更好的是，内置单元测试，并自动化该过程。Branca 令牌已经发布了 vectors，并且正在讨论的`.net`实现未能复制。哎呀。

另一个好的加密方法是使用常数时间函数来阻止基于时间的攻击。同样，在我们的示例库中，Branca 使用 Poly1305 消息认证码(MAC)。MAC 实质上是附加到要验证的字符串的带密钥的散列。这是传出消息中最后更改的内容，也是传入消息中首先检查的内容。如果 MAC 没有验证，该消息可以立即被丢弃。攻击者可能能够检测到接收端需要多长时间来丢弃带有无效 MAC 的消息。如果比较是以一种天真的方式进行的，就像这里一样，那么时间会暴露出在比较过程中，信息与预期的差异有多大。你知道电影中超级秘密密码被一次猜中一个字符的场景吗？这就是针对这种缺陷的定时攻击的工作方式，也是您想要避免的。

显然，在使用加密技术时会遇到更多的问题，但是这个特殊的故事强调了您应该采取的两个首要步骤，以确保您正确地使用加密技术。使用已知良好的代码和算法，用输出验证输入，并遵循最佳实践，如常数时间字符串比较。

## 为了乐趣和利润而入侵谷歌的基础设施

[沃特·玛特]和[埃泽奎尔·佩雷拉]正在研究谷歌的云 SQL 服务，[在一个 CSV 导出函数中发现了一个 SQL 注入](https://offensi.com/2020/08/18/how-to-contact-google-sre-dropping-a-shell-in-cloud-sql/)。只需一点小聪明，他们就可以将数据库中的数据转储到`/mysql/temp/`目录中的指定文件中。真正的技巧是他们可以再次运行导出，但是拦截 API 调用并修改它，向`mysqldump`命令添加命令行选项。

其中一个选择？指定身份验证插件。因为他们已经有能力在文件系统上删除一个文件，让`mysqldump`运行一个恶意插件相当容易，导致一个反向外壳。由于他们的努力，他们从谷歌网站可靠性工程(SRE)团队那里得到了一条以`greetings.txt`文件形式的消息。他们发现的错误已经被修复，但在此之前他们发现了一个 SSH 劫持，该劫持允许逃离 SQL 容器。希望谷歌为他们的辛勤工作支付了丰厚的奖金。