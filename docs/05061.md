# 本周安全:Tegra Bootjacking，泄漏 SSH，和 StrandHogg

> 原文:[https://hack aday . com/2019/12/06/this-week-in-security-tegra-boot jacking-leaking-ssh-and-strand hogg/](https://hackaday.com/2019/12/06/this-week-in-security-tegra-bootjacking-leaking-ssh-and-strandhogg/)

CVE-2019-5700 是 Nvidia Tegra bootloader 中的一个漏洞，由[Ryan Grachek]发现，并在 Hackaday 这里首次突破。要理解这个漏洞，首先必须了解一点关于 Tegra 引导过程的知识。当设备通电时，irom 固件从设备的闪存中加载引导过程的下一阶段，并验证该二进制文件上的签名。顺便说一下，[我们已经在 irom 代码 selfblow 中覆盖了一个类似的漏洞](https://hackaday.com/2019/07/26/this-week-in-security-selfblow-encryption-backdoors-killer-apps-and-the-vlc-apocalypse-that-wasnt/)。

在 Tegra T4 设备上，irom 加载一个 bootloader.bin，然后引导系统映像。K1 引导堆栈使用额外的引导加载程序阶段 nvtboot，它在将控制权交给 bootloader.bin 之前加载安全操作系统内核。以后的设备会添加额外的阶段，但这对理解这一点并不重要。该漏洞使用了一个 Android 启动映像，神奇之处就发生在头部。这个引导映像的一部分是可选的第二阶段引导加载程序，这在实践中很少使用。这个引导映像的头指定了每个元素的字节大小，以及将该元素加载到哪个内存位置。[Ryan]意识到的是，虽然它通常被忽略，但关于第二阶段引导加载程序的信息受到官方 Nvidia bootloader.bin 的尊重，但无论是大小还是内存位置都没有经过完整性检查。在加密验证发生之前，图像被复制到它们的最终位置。因此，Android 映像可能会覆盖正在运行的引导加载程序代码。

利用此漏洞的最简单方法是用 NoOp 指令替换验证例程。旧的 T4 设备在加载可信操作系统之前复制 Android 映像，因此可以加载未签名的代码作为安全操作系统映像。如果你想更深入地了解技术细节，[Ryan]已经发表了关于 CVE 的[笔记。](https://github.com/oscardagrach/CVE-2019-5700)

那么这对业余爱好者来说意味着什么呢？它允许以相当于 ring 0 的速度运行 uboot。它允许在 Tegra 设备上运行更新的 Android 版本。甚至有可能在 Nvidia Shield TV 上加载任天堂 Switch 自制软件，因为这些几乎是相同的硬件。像这样的黑客对自制和修改社区来说是一个巨大的恩惠。

我们以前见过这种情况，我怀疑这种类型的漏洞会在未来出现，特别是随着 ARM 设备的不断普及。我建议将这类漏洞称为引导劫持，因为它是引导过程的劫持，也是将指令劫持到现有的引导加载程序中。

### 泄漏的 SSH 证书

SSH 证书是对简单密码的重大升级。以至于像 Github 和 Gitlab 这样的服务已经开始强制使用 SSH 密钥。这些服务的一个怪癖是:任何人都可以从 Github 下载公共 SSH 密钥。当客户机连接到 SSH 服务器时，它会通过发送相应的公钥来列出它可以访问的密钥。作为响应，如果服务器信任这些密钥中的任何一个，它就发回一个通知，这样客户机就可以用这个秘密密钥进行身份验证。

【Artem Golubin】注意到了潜在的数据泄露，[详细写了出来](https://rushter.com/blog/public-ssh-keys/)。您可以在 Github 上选择一个开发人员，获取他的公共 SSH 密钥，并开始检查面向公众的 SSH 服务器，以找到在哪里可以识别该公共密钥。这似乎已经融入了 SSH 协议本身，而不仅仅是一个实现上的怪癖。这不是那种可以变成蠕虫或直接危害服务器的缺陷，而是一种有趣的信息收集工具。

### 暴露在外

HackerOne 是一个 bug-bounty-as-a-service，代表了一批科技公司。就在最近，他们宣布在 HackerOne 基础设施本身发现了一个漏洞。一名使用该平台的安全研究人员[Haxta4ok00]在一次关于一个不相关的 bug 报告的来回交流中意外地获得了一名员工的会话密钥，并发现该会话密钥允许他以与该员工相同的权限访问 HackerOne 基础架构。

会话密钥劫持不是一个新问题；这是导致我们今天看到的“HTTPS 无处不在”做法的袭击之一。一旦用户通过了某个网站的身份验证，该身份验证如何“粘”在用户身上？每次页面加载时发送用户名和密码并不是一个好主意。解决方案是会话密钥。一旦用户通过身份验证，服务器就会生成一个长的随机字符串，并将其传递回浏览器。该字符串是商定的令牌，用于在所有进一步的通信中对该用户进行身份验证，直到达到时间限制，或者该令牌因其他原因而失效。

不久以前，大多数 web 服务只在初始用户登录时使用 HTTPS 连接，而在大部分数据传输时则退回到未加密连接。这个会话密钥是未加密有效负载的一部分，如果它被捕获，攻击者就可以劫持合法会话并充当用户。Firesheep 浏览器扩展清楚地表明了这种攻击是多么容易实现，并推动许多服务最终通过全职 HTTPS 连接修复了这个问题。

HTTPS 无处不在是防止会话劫持的一大进步，但正如在 HackerOne 上看到的，它并没有涵盖所有情况。HackerOne 员工在 curl 命令行中使用了有效的会话密钥，并意外地将其包含在响应中。[Haxta4ok00]注意到了这个密钥，并很快确认了它是什么，它允许他访问 HackerOne 内部基础设施。

泄漏被报告，密钥很快被撤销。因为是私信泄露的，所以只有[Haxta4ok00]有权限。也就是说，其他几个私人漏洞报告被访问。值得一提的是，HackerOne 尽他们所能地处理了这个问题，并为该报告奖励了 2 万美元。他们更新了他们的研究指南，现在将这些会话密钥限制在生成它们的 IP 地址上。

[通过 Ars Technica](https://arstechnica.com/information-technology/2019/12/hackerone-breach-lets-outside-hacker-read-customers-private-bug-reports/)

### 斯特兰德霍格

过去一周最引人注目的故事之一是关于安卓系统，以及伪装成合法应用的恶意应用。自 2017 年以来，StrandHogg 一直被以这样或那样的形式利用，并于 2015 年在[的一篇 Usenix 论文中首次提出理论。在某些方面，这是一个非常简单的攻击，但做了一些非常聪明的事情。](https://www.usenix.org/system/files/conference/usenixsecurity15/sec15-paper-ren-chuangang.pdf)

那么它是如何工作的呢？恶意应用程序一旦安装，就会在后台运行，等待目标应用程序启动。一旦检测到目标 app，恶意 app 就会跳到最前面，伪装成目标。由此看来，网络钓鱼攻击是微不足道的。然而，更有趣的是权限攻击。您的良性应用程序似乎请求文件系统权限、相机权限等。目前还不清楚恶意应用程序是否真正在请求权限。

这里唯一的实际漏洞似乎是恶意应用程序能够重命名和“重新命名”自己，以欺骗成为目标应用程序的一部分。请注意，在 StrandHogg 攻击期间，至少在权限弹出窗口中，请求应用程序的名称是空白的。

### 非接触式支付

第一次看到非接触式支付时，你会觉得它很神奇。只要在支付终端上挥动兼容的卡或移动设备，支付就通过 NFC 进行了。既然你正在阅读这篇专栏文章，那么可以有把握地假设，在最初的敬畏消失之后，你会开始想知道这一切是如何安全地完成的。这也是[利-安妮·加洛韦]和[蒂姆·尤努索夫]想知道的。他们刚刚发布了他们的研究，并设法发现了几个令人讨厌的花招。一顶锡纸帽子可能有点过头了，但也许是时候投资一个 NFC 阻挡钱包了。

他们操纵传输中的数据，允许在没有 PIN 输入的情况下进行更大规模的支付，通过 NFC 代理进行购买，甚至展示了一种实际的预付费攻击，可以读取卡，进行虚假交易，然后在真实的支付终端上播放该虚假交易。

### 超级鱼回报？

Twitter 是一个迷人的地方。有时简单的观察结果是 CVE。当[SwiftOnSecurity]指出一个奇怪的 DNS 名称“atlassian-domain-for-localhost-connections-only . com”时，发生了一个有趣的互动，描述它允许安全的 HTTPS 连接到运行在 localhost 上的服务。我们在 Google Project Zero 的朋友(塔维斯·奥曼迪)指出，安装在 localhost 上的有效 https 证书意味着 Atlassian 必须将该域名的私有证书作为其软件的一部分。点击链接，你也可以用有效的 HTTPS 证书托管这个奇怪的域名。

![](../Images/aebdb40f5d02e502ab9d2ac5ad599df6.png)

出于几个原因，这是一个坏主意，但不是可能发生的最糟糕的事情。这种错误的最坏情况可能属于超级鱼。2014 年，许多联想电脑都预装了一个名副其实的广告软件程序，其有用的功能是向你展示更多个性化的广告。为了做到这一点，该软件只需将自己的证书颁发机构信息添加到系统的可信 CA 包中，并将私有证书和密钥随软件一起发送。是的，你没看错，对联想用户来说，任何 HTTPS 的证书都可能是伪造的。

查看 Atlassian 域，另一个用户注意到 IBM 的 Aspera 软件有一个类似的 localhost 域和证书。根据[Tavis]的说法，该软件还包括一个完整的 CA 证书和密钥。如果 IBM 软件的一次迭代真的将该 CA 添加到了系统的根信任中，那么这又是一条超级鱼:任何 HTTPS 认证都可以被成功地欺骗。