# 本周安全:蓝牙黑客、NEC 手机和恶意 Tor 节点

> 原文：<https://hackaday.com/2020/08/21/this-week-in-security-bluetooth-hacking-nec-phones-and-malicious-tor-nodes/>

漏洞研究的一个有趣之处是有太多的地方可以让漏洞藏身。现代设备有多个处理器、一些无线电硬件和数百万行代码。当 Dark Mentor LLC 的[Veronica Kovah]决定开始对蓝牙低能耗协议进行漏洞研究时，她选择了针对链路层本身，而不是作为主操作系统的一部分运行的代码堆栈。有趣的是，链路层必须在执行任何身份验证之前处理数据，因此如果在这里发现漏洞，它肯定是预身份验证。同样有趣的是，许多不同的设备可能共享相同的 BLE 芯片组，这意味着这些漏洞将出现在许多不同的设备上。[Veronica]在 PDF 白皮书中分享了一些关于如何开始的重要信息，以及她发现的漏洞的详细信息。(简单说明一下，这个链接不是指向原始 PDF，而是打开 GitHub PDF 查看器。)如果你感兴趣的话，还有一个关于调查结果的视频介绍(T2)。

我们将关注的第一个 vuln 是 CVE-2019-15948，它影响了一些德州仪器的 BT/BLE 芯片。问题在于如何处理 BLE 广告数据包。广告数据包应始终包含至少六个字节的数据长度，这是为发送设备地址保留的。数据包解析过程的一部分是从数据包长度中减去 6，并使用该值作为长度进行`memcpy`。恶意数据包的长度可能小于 6，结果是复制长度整数下溢，变成一个大值，并覆盖当前堆栈。为了真正将这变成一种利用，一对数据包被重复发送，以将恶意代码放在程序执行将跳转到的地方。

值得注意的第二个漏洞是 CVE-2020-15531，它以硅实验室 BLE 芯片为目标，并使用格式错误的扩展广告数据包来触发缓冲区溢出。具体来说，发送的消息比规范规定的要长。芯片的固件没有丢弃这种格式错误的消息，而是对其进行处理，从而触发缓冲区溢出。更进一步，该芯片具有非易失性固件，并且可以永久修改该固件。[Veronica]指出，即使像这样的嵌入式芯片也应该有某种安全引导实现，以防止这种持续的攻击。

### NEC 电话系统公司

这个故事是由[奥斯汀·马丁内蒂]直接发送的，他与[布雷特·布莱恩特]一起从事这项研究。他们看了看一个有趣的平台， [NEC 电话系统](https://shadytel.su/files/necsploits.htm)。他们发现了什么？一些问题，如硬编码的用户名/密码，以及将用户密码重置为默认值的 HTTP 端点:`PasswordReset.htm?PWD_RESET()`一旦您可以访问 web 界面，您可以做什么？下载语音邮件消息的隐藏端点怎么样？对于不耐烦的人，甚至有一个快速和肮脏的脚本来自动下载整个语音邮件积压的过程。接下来是真正有趣的开发者级别账户。在 web 浏览器中只需对帖子数据进行一点点操作，就可以修改一个帐户，使其拥有高于管理员的权限级别。

所有这些都很有趣，但是我们知道最好不要将嵌入式设备的 web 界面暴露在互联网上。只要外界无法进入，我们就不必担心这些虫子。对吗？似乎当 NEC 建立他们的语音邮件插件时，他们内置了一个巧妙的隐藏功能。在分机 740 上，可以使用老式拨号调制解调器。来自 web 界面的任何有效凭据都可以建立连接并获得对系统的访问权限，包括一些未记录的服务。

这些漏洞被私下披露，[更新固件可用](https://www.necplatforms.co.jp/press/files/SVSLSecurityAdvisory20200731.pdf) (PDF)。如果你的办公桌上碰巧有 NEC 手机，那么尝试更新固件可能是值得的。看在上帝的份上，不要把你的电话系统的端口放到互联网上！

### Tor 出口节点

Tor 对于互联网上的匿名来说是一个福音，但是你曾经仔细观察过它潜在的负面影响吗？Tor 是一个智能的网状网络，它使用多层加密来对流量进行高度匿名化，通过多个中继发送流量，并最终通过出口节点发送到常规互联网。该出口节点在多方面都是 Tor 网络的弱点。由于有时通过 Tor 发送恶意或非法流量，出口节点经常成为执法机构或网络运营商的目标。由于另一个原因，这些节点是一个弱点—出口节点可以检查并可能修改通过它的所有流量。

这应该不成问题，因为我们有 TLS 来防止 MitM 攻击。有一种巧妙的攻击可以绕过 TLS 保护，即 SSL 剥离，这是由[莫邪·马林斯派克]在 2009 年提出的。这个想法很简单:当用户试图使用 HTTP 访问网站时，网站返回一个重定向到 HTTPS 的连接。攻击者拦截该重定向并代理 HTTPS 连接，让用户处于未加密的连接状态。这种攻击用处有限，因为 web 浏览器会记住一个永久重定向，这就是为什么使用“301 永久移动”重定向来强制 HTTPS 连接被认为是最佳实践。

也就是说，你认为目前有多少 Tor 出口节点是恶意的？根据[nusenu]的说法，在某一点上[，几乎 25%的 Tor 出口节点连接使用了恶意出口节点](https://medium.com/@nusenu/how-malicious-tor-relays-are-exploiting-users-in-2020-part-i-1097575c0cac)。这不是一个容易解决的问题，因为绝大多数出口节点是由志愿者运行的。当发现这些恶意节点时，许多节点会被立即删除，但相对简单的方法是重新排列名称和 IP，然后将这些节点放回网络中。据估计，目前，当您使用 Tor 时，有 10%的机会使用恶意出口节点。这是一个众所周知的问题，正在慢慢解决，但是目前 Tor 项目还没有足够的资源来认真解决这个问题。如果你打算使用 Tor 访问外部站点，请确保特别检查你的连接是有效的 HTTPS 连接。

### 红队的故事

infosec 中一些最好的故事来自做渗透测试的红队。本周，[费德里科·拉戈]分享一些最近一次成功的圣灵降临节的故事和小贴士。本文中的一个最佳技巧是尝试扫描端口，同时将源端口指定为常用端口。显然，许多防火墙被错误配置为允许来自这些端口的传入流量，而其本意是允许传出流量。

第二个提示是，简单网络管理协议(SNMP)在泄露系统信息方面非常强大。它不是 TCP 服务，所以很容易错过，但这是值得努力的。可以获得很多潜在的信息，包括进程列表及其命令行参数。在这种情况下，为之前发现的 Jenkins 实例找到了有效的用户名/密码组合。Jenkins 可以配置为启用“脚本控制台”，并且有可能滥用它来获得反向 shell 和对 bash 的访问。

第二部分继续这个故事，详细描述了他们如何使用 sudo 运行一个命令来获得一个根 shell，然后使用相同的 SNMP 技巧来访问公司的数据库。整本书都很值得一读，所以去看看吧。

### 比特和字节

Ars 告诉了我们 FritzFrog ，这是一个新的 Linux 僵尸网络客户端，它通过糟糕的 SSH 密码策略传播。[Guardicore](https://www.guardicore.com/2020/08/fritzfrog-p2p-botnet-infects-ssh-servers/)的技术报告有着有趣的细节和妥协的迹象。您可能希望检查您的服务器是否有添加的 ssh 授权密钥、从不存在的位置运行的二进制文件以及端口 1234 上的监听套接字。

Gmail 的 [DMARC/SPF 保护可以通过使用 Gmail 的入站网关设置和 G 套件管理控制台中的全局邮件路由设置来短路](https://ezh.es/blog/2020/08/the-confused-mailman-sending-spf-and-dmarc-passing-mail-as-any-gmail-or-g-suite-customer/)。实质上，入站网关会关闭对来自指定 IP 地址的邮件的 SPF 和 DMARC 检查。通过谷歌的邮件服务转发意味着邮件被谷歌签名，所以它通过了这些检查。虽然出现了一些复杂情况，但现在已经修复了这个 bug。

Kali Linux，以前的 Backtrack，已经[发布了他们的 2020.3 版本](https://www.kali.org/news/kali-2020-3-release/)。最值得注意的是增加了一套新的蓝牙工具。还有新的“Win-KeX ”,这是一个持久的 GUI，用于在 Linux 的 Windows 子系统中运行 Kali。