# 本周安全:帕洛阿尔托得分 10，诅咒图像，虚拟机逃逸，恶意音乐

> 原文：<https://hackaday.com/2020/07/03/this-week-in-security-palo-alto-scores-a-10-cursed-images-vm-escapes-and-malicious-music/>

这些年来，我们在 Hackaday 上查看了许多漏洞，但 CVE 很少能达到完美的 10 级严重程度。这是留给最严重和最容易被利用的问题。帕洛阿尔托[29 日公布了这样一个漏洞，CVE-2020-2021](https://security.paloaltonetworks.com/CVE-2020-2021) 。此漏洞会影响运行 PAN-OS 的 Palo Alto 设备，这些设备启用了 SAML 身份验证并禁用了某个验证选项。该漏洞是预身份验证，但需要访问受 SAML 身份验证保护的服务。例如，提供基于 web 的 VPN 的 Palo Alto 设备可能容易受到攻击。好消息是易受攻击的设置不是默认的，但坏消息是官方配置指南建议在某些情况下使用易受攻击的设置，如使用第三方认证服务。

问题出在安全断言标记语言(SAML)实现中，SAML 是一种基于 XML 的开放身份验证标准。SAML 的主要用例之一是提供单点登录(SSO)方案。SAML SSO 的正常部署是由一个中央提供者来处理用户的身份验证，然后向各个服务断言连接的用户实际上就是他们所声称的那个人。

利用此漏洞所需的设置是禁用“验证身份提供者证书”。如果启用此选项，SSO 提供程序必须使用 CA 签名的 SAML 证书。这似乎并不意味着未签名的 SSL 证书会被接受，它只适用于 SAML 消息中的证书。人们似乎普遍认为[这些证书不需要 CA 签名](https://security.stackexchange.com/questions/146132/self-signed-certificate-for-a-idp-initiated-saml-sso)。在官方公告中，漏洞类型被称为“CWE-347 加密签名不正当验证”。

除了认为该漏洞非常容易被利用，并为攻击者提供管理员级别的访问权限之外，没有给出关于该漏洞的更多详细信息。美国网络司令部甚至宣布，我们应该期待外国行动者立即开始利用这一漏洞。我们可以有根据地猜测这里发生了什么。因为它被归类为不正确的验证攻击，所以我们可以假设本应由 SSO 提供者提供的信息可以由攻击者提供。这种攻击很可能是这种攻击的变体:攻击者发出验证请求，但是在请求中，还包括来自 SSO 提供者的大部分有效的欺骗响应，声称请求是有效的。受害设备没有正确处理意外的额外条目，而是接受了该消息。

很可能最终会发布一个概念验证，所以希望我们可以回到这个漏洞，看看我们的猜测有多准确。

### 诅咒图像的紧急窗口补丁

一对 Windows bug[在正常的周二补丁周期](https://www.zdnet.com/article/microsoft-releases-emergency-security-update-to-fix-two-bugs-in-windows-codecs/)之外被修补。CVE-2020-1425 & CVE-2020-1457 是 Windows 编解码器库中的缺陷，特别是在处理图像编解码器方面。使用这个库的应用程序只需要解析恶意图像就可以触发代码执行。值得注意的是，这些缺陷和修复不是通过 Windows Update 进行修补，而是通过微软商店进行修补。

### VMware Escape 漏洞

最近披露了 VMware 虚拟化平台中的一对漏洞。 [CVE-2020-3962 和 CVE-2020-3969](https://www.vmware.com/security/advisories/VMSA-2020-0015.html) 都瞄准了为虚拟机提供图形输出的虚拟 SVGA 设备。这两种攻击都需要启用图形加速，这是某些 VMware 产品的默认状态。

给出的信息不多，除了一个是释放后使用问题，而另一个是一个堆溢出问题。有趣的是，这两个缺陷都允许逃离虚拟化环境并在虚拟机管理程序上运行代码。我们中的许多人都有一个虚拟机，用于打开可疑文件、访问已知的恶意链接和其他各种安全研究。这里的假设是恶意软件几乎不可能跳回主机。像这样的漏洞很好地提醒了我们，这种假设并不总是成立的。

### 恶意音乐

我的兴趣被 TuxGuitar 中一个小漏洞的故事激起，这是一个编辑和查看吉他乐谱的程序。吉他音乐通常以一种独特的格式写出来，通常简称为“tab”。这种形式的音乐是足够的利基，几个专门的文件格式和编辑器专门为它服务。[Michael Dardas]很感兴趣地看了看源代码，[发现了一些问题](https://logicaltrust.net/blog/2020/06/tuxguitar.html)。

XML 是一头复杂的野兽，有着自己的安全问题。其中一个潜在的问题是 XML 外部实体(XXE)攻击。简而言之，XXE 引用一些外部服务或文档作为 XML 文件的一部分。TuxGuitar 程序在它加载的基于 XML 的选项卡文件中没有足够的 XXE 检查。这意味着恶意的 tab 文件可能会泄露 IP 地址、泄漏本地文件或执行其他有限的有害操作。

现在，TuxGuitar 不是一个关注安全性的应用程序，很可能作者没有考虑到可能的安全缺陷。这是一个容易落入的陷阱。然而，即使没有直接明显的攻击媒介，通常仍然有利用漏洞的途径。我可以想象一个有针对性的攻击，使用一个 tab 文件来暴露 Tor 用户。

据我所知，这个问题在上游项目中没有得到解决，所以如果你碰巧使用 TuxGuitar，要警惕不可信的 tab 文件。

### 零碎东西

如果你还没看完，那就去看看与 Ghidra 合作的关于逆向工程的新 Hackaday U 系列吧！这是一个使用该工具和逆向工程的初学者指南，由[wrongbaud]提供。

三大主流浏览器都已经正式加入了为期一年的 SSL 有效期列车。关于这项新政策，浏览器供应商(谷歌和苹果)和 CA 提供商之间发生了一些戏剧性的事情。并非所有人都对这一变化感到高兴，但 Firefox、Chrome 和 Safari 现在拒绝接受超过一年的 SSL 证书。

上周我们讨论了 Ripple20 ，这是广泛使用的 TCP/IP 协议栈中存在的一系列安全问题。虽然这项研究本身是一流的，但我对他们披露过程中的一些细节感到不快。这项研究背后的公司 JSOF 回应了我的烦恼。去检查一下，特别是如果你在他们的回复被添加之前阅读了它。

我仍然不喜欢放弃我的电子邮件地址来访问实际的漏洞论文，但我已经看到了几个包含这些漏洞的设备的报告，而没有准备好修复这些问题的补丁。至少在某些情况下，所讨论的漏洞确实是 0 天问题。此外，值得一提的是，19 期杂志中有两期的 CVE 得分也达到了 10 分。