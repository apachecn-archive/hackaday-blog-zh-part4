# 本周安全:不安全的充电器、请求伪造和内核安全

> 原文:[https://hack aday . com/2021/08/06/this-week-in-security-unsecured-chargers-request-forgeries-and-kernel-security/](https://hackaday.com/2021/08/06/this-week-in-security-insecure-chargers-request-forgeries-and-kernel-security/)

Pen Test Partners 的人决定[看看电动汽车充电器](https://www.pentestpartners.com/security-blog/smart-car-chargers-plug-n-play-for-hackers/)。这些充电器中有许多都是 WiFi 连接的，让你可以通过云检查车辆的充电状态。它们有多安全？可以预见的是，没有他们想象的那么好。

测试的最差的设备 Project EV 实际上在服务器端 API 上没有任何用户认证。知道序列号就足以进入账户并控制设备。序列号是可预测的，所以接管每一个连接到互联网的项目电动车充电器将是微不足道的。最重要的是，任意固件可以远程加载到硬件上是可能的，这是一个真正的潜在问题。

EVBox 平台有一个不同的问题，通过身份验证的用户可以简单地指定一个安全角色。tenantadmin 角色在这里特别有趣，它作为超级管理员可以查看和管理多个帐户。这个缺陷在令人印象深刻的 24 小时内被修补。由于在产品中使用了 Raspberry Pi 硬件，他们检查的 ~~EVBox 充电器~~以及其他几个设备存在根本的安全漏洞。编辑:EVBox 不是*最终产品中使用 Pi 的设备之一。

## 等等，树莓派怎么样？

显然，树莓派不属于物联网硬件的观点引起了 Pen Test Partners 的一些抨击，因为几天后[他们发表了一篇后续文章解释他们的基本原理](https://www.pentestpartners.com/security-blog/why-the-raspberry-pi-isnt-suitable-for-iot/)。简单来说，Pi 做不到安全引导，也做不到加密存储。他们在上述充电器中发现的几个缺陷之所以被发现，是因为设备文件系统对检查完全开放。能够处理设备加密的处理器，最好比我们上周讨论的 TPM 和 Windows Bitlocker 组合更好，能够提供一些真正的安全性来抵御这种攻击。

现在 Pi 上的 Linux 当然可以做加密文件系统，但是真正的问题是加密密钥的存储。如果在 SoC 中没有安全的飞地，就很难拥有一个不能被物理访问的攻击者轻易读取的加密密钥。在笔记本电脑上，这不成问题，因为用户可以提供密码作为加密密钥的一部分，但谁愿意每次开机时都在每台物联网设备上输入密码呢？

## Snapcraft 侧面装载

[Amy Burnett]在 Ubuntu 系统上发现了一些没有意义的东西——一个 Docker 命令抛出了一个 segfault。更奇怪的是，只有在一个特定的文件夹中运行命令时才会出现这种情况，这个文件夹中还存储了一个`libc.so.6`文件。她的安全感刺痛了。由于某种原因，当 docker 命令运行时，库文件可能正在被加载。一个快速的`strace`证实了这个理论，但是为什么会发生这种情况呢？答案是 Ubuntu 新的 Snapcraft 包管理器中的一个安全漏洞。Ubuntu 已经开始以快照的形式提供某些程序，而不是传统的软件包。

罪魁祸首是用于构建`LD_LIBRARY_PATH`局部变量的 Snapcraft 逻辑。如果用于构建该变量的变量之一为空，则字符串中会出现一个双冒号。Linux 将其解释为当前目录，因此运行通过 Snapcraft 安装的包可能会无意中加载动态库。一种建议的攻击是分发存档中的视频文件，包括恶意库。任何用户只要提取文件并在安装了 Snapcraft 的播放器中播放视频，就会自动加载恶意库。该问题被跟踪为 CVE-2020-27348，并于 2020 年底修复。

## 请求伪造

本周，三个关于伪造请求的故事浮出水面，第一个是 OkCupid 上的一个跨网站伪造请求(CSRF)。首先，CSRF 攻击是指访问一个网站会触发另一个网站的操作。跨源资源共享应该是这个问题的解决方案，但是有一些你应该知道的警告。这里重要的一点是，HTML 表单可以将帖子发送到另一个域，即使没有设置 CORS 头。防范这种攻击的常见方法是使用 CSRF 令牌来确认该请求确实来自一个经过批准的站点。OkCupid 没有使用这些令牌，因此可以构建一个代表用户触发动作的网页。

另一种常见的请求伪造模式是服务器端请求伪造(SSRF)。这一个有点不同:这里我们欺骗服务器生成一个非预期的请求。这通常发生在前端服务器向非公共后端服务发送流量的情况下。这里是[包含一个内部 URL 作为调用脸书 API](https://philippeharewood.com/facebook-ssrf/) 的参数的能力。似乎 API 端点天真地接受任何 URL 作为有效图像，即使该位置不是不应该公开访问的位置。在这种情况下，这一行动泄露了内部端点的内容，使研究人员能够获得一个金丝雀令牌，并获得一对 30，000 美元的奖金。

最后一个故事在本周晚些时候发布，它都是关于 HTTP/2 的。这种相对较新的协议是 HTTP 的潜在替代品，旨在使 web 更快、更灵活。猜猜新协议带来了什么。是的，新的创造性的方法来打破它。PortSwigger [的【James Kettle】涵盖了相当多与请求走私相关的潜在漏洞](https://portswigger.net/research/http2)，大多涉及前端服务器将 HTTP/2 转换为 HTTP 1.1。这些攻击类似于在 HTTPS/2 字段中包含冒号或换行符，这些符号一旦被翻译成 HTTP 1.1 就会有不同的解释。

宣布的最重要的漏洞可能是 CVE-2021-33193，这是阿帕奇`mod_proxy`中的一个缺陷。前端 HTTP/2 服务器和后端服务器对传入头中的空白理解不同，这是一个问题。这使得攻击者可以请求一个特权端点，比如说`/wp-admin`，但是将这个请求伪装成一件不感兴趣的事情。这种策略可以绕过访问规则，允许访问这些位置。该缺陷已在 Apache master 中修复，并将成为 2.4.49 版本的一部分，但这里我们讨论的是漏洞，2.4.49 尚未发布。如果您运行易受攻击的服务器，可能是时候禁用 HTTP/2 了。

## 幻觉 TLS 解密

SySS 刚刚发布了作为开源项目的[幻觉](https://blog.syss.com/posts/hallucinate/)。这个项目是所有关于解密 SSL 流量，不是在网上，而是通过挂钩到操作系统或应用程序进行加密。潜在的使用案例相当广泛。试图弄清楚一个闭源二进制文件正在向云端发送什么数据？解决加密数据中难以确定的错误？幻觉可能会有帮助。它可以吐出一个解密的 PCAP 文件，甚至运行 Python 脚本来实时操作加密数据。绝对是一个有用的技巧来添加到你的图书馆。

## 谷歌对内核安全性的看法

谷歌开源安全团队[的【Kees Cook】本周发表了一篇文章，谈论了 Linux 内核内部和周围的安全状态](https://security.googleblog.com/2021/08/linux-kernel-security-done-right.html)。他指出，虽然内核在正常工作时运行得很好，但当它崩溃时，它会以不安全的方式崩溃。换句话说，他希望看到更多的工作来使内核即使在有缺陷的情况下也能有弹性地妥协。虽然帖子中没有详细说明需要做哪些改变，但我只能想到像给内核添加 Rust 和进行额外的地址随机化这样的努力。

这篇文章的大部分不是针对上游的内核，而是针对下游的集成商。这里的建议很简单。跟踪最新版本或稳定内核。不要使用 10 年前的内核。这是一个挑战吗，因为你有这么多的树外内核代码？上游你的变化。这让每个人都更有安全感。与其花费这么多工程上的努力来修复你古老的内核，不如花精力让上游的内核更加安全。有趣的是，他在文章结尾认为，Linux 内核和工具链需要大约 100 多名熟练的工程师来有效维护。