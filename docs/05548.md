# Linux Fu:Linux 洗牌

> 原文:[https://hackaday.com/2020/02/03/linux-fu-the-linux-shuffle/](https://hackaday.com/2020/02/03/linux-fu-the-linux-shuffle/)

众所周知，计算机是精确的，而且通常是可重复的。这就是为什么很难从他们身上得到看似随机的东西。然而，随机的东西对游戏、加密和多媒体来说是很棒的。谁希望播放列表或幻灯片每次都是相同的顺序呢？

很难得到真正的随机数，但在很多情况下，这并不重要。更好的是，如果你在编程或使用脚本语言，有很多东西可以用来获得某种程度的随机性，这对于许多目的来说是足够的。

## 随机的根源

在你的设备目录中有两个你以前可能没有注意到的准文件。`/dev/random`和`/dev/urandom`文件将输出您想要读取的任意数量的随机字节。为什么有两个？内核从不同的地方抓取嘈杂的数据。例如，它可以读取加密硬件或测量磁盘访问之间的时间间隔。这些数字不容易预测，可以成为难以猜测的数字的良好来源。然而，对于一定数量的随机比特，你需要一定数量的随机噪声。`/dev/random`设备文件填充了这些环境随机位，如果它需要更多的随机测量来完成请求，它将一直阻塞，直到获得它们。另一方面，`/dev/urandom`文件将提供“无限”数量的字节；它通过周期性地重新播种具有环境随机性的伪随机数生成器来工作。

如果你用普通语言编程，很容易打开这些文件中的任何一个并读取你想要的字节数。在普通的 shell 脚本中，这也很容易。例如:

```
head -c 3 /dev/random | od -t x1 -A none
```

这个命令会给你三个十六进制字节。如果你愿意，你可以改变`x1`来得到十进制数字或者任何你想要的东西。

## 更好的外壳

当然，外壳知道你想这么做。Bash 会不断更新`$RANDOM`,如果您愿意，您可以从中读取:

```
for i in {1..5}
do echo $RANDOM
done
```

这将每次给你五个随机数。

## 更好的是

这很简单，但我们还可以做得更好。毕竟，假设您在一个文件中有一堆谚语，每行一句。即使是一个随机数，你也需要跳过这些行，担心文件总共有多少行。有一种更好的方法:使用`shuf`命令。

这个命令乍一看似乎很简单，但实际上非常强大。bare 命令读取一个文件或标准输入，并根据一个随机数对其进行置换。如果你愿意的话，可以选择输入你自己的随机数。

有时您不想要文件中的所有项目。例如，从一个文件中挑选一段引文，您可能只是想要下一首随机的歌曲。`-n`选项将输出限制在第一行或多行。如果想洗牌，可以使用`-i`选项。例如:

```
shuf -n 1 -i1-10
```

这个命令会给你一个 1 到 10 之间的随机数。非常容易！

回到从文件中随机选择一个引用，就像:

```
shuf -n1 input_file.txt
```

结合文件列表，这也可以很容易地选择随机文件:

```
ls *.mp3 | shuf -n 1
```

## 什么时候选择哪个

注意,`shuf`命令是 GNU 核心工具的一部分，所以有些机器没有它。在 BSD 中，`jot`命令有点类似。对于一个更易移植的脚本来说，检查`shuf`是否存在可能是明智的，也许寻找`jot`，如果你都没有找到，试着看看`$RANDOM`是否改变。您可以使用`awk`处理原始数字。如果没有，您可以检查`/dev/urandom`和`/dev/random,`，这也需要一些处理。

使用这些工具，您可以编写令人愉快的不可预测的脚本。(当然，我们的一些脚本也不那么不可预测。但我们不能因此责怪`/dev/urandom`。)

如果你想深入研究`/dev/random`，可以看看埃利奥特写的关于 [Linux 熵收集系统](https://hackaday.com/2017/11/02/what-is-entropy-and-how-do-i-get-more-of-it/)的文章。