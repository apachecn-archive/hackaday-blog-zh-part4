# ESP32 漏洞影响旧芯片

> 原文：<https://hackaday.com/2020/09/24/esp32-vulnerability-affects-older-chips/>

电影《红色》(已退休，极度危险)中有一个场景，布鲁斯·威利斯在中情局内部遇到了一扇高度安全的门，门上的锁密码不断变化。知道锁不可能被打破，他干脆破坏了门旁边的墙，把手伸进去，从另一边打开了门。当我们看到[raelize]的黑客绕过 ESP32 的安全措施时，我们想到了这一点。

不过，在你扔掉所有的 ESP32 间谍小工具之前，请注意 V3 硅可以防止攻击。然而，V1 和 V2 有一个缺陷——如果你知道如何利用它——使得安全引导和闪存加密几乎毫无意义。

黑客攻击的中心是 UART 引导程序。您可以使芯片进入该模式，并执行基本操作，如读写 RAM 和寄存器。你也可以从内存中执行代码。不过，这并不是特别的安全风险，因为闪存可能是加密的。解密在硬件中是透明的，并且芯片在引导加载模式期间不进行解密。当然，你可以读取加密的闪存，但你也可以用一些奇特的拆焊或探测技术来读取。

在正常引导期间，闪存中的引导加载程序被放置在 RAM 中。如果你能在正确的时间让 CPU 出故障——理论上——你就能迫使处理器在闪存已经解密的正常模式下运行你的基于 RAM 的代码。唯一的问题是，他们尝试了大约 1，000，000 个周期，没有成功。但是他们确实注意到了一些奇怪的事情。

故障期间发生的非法指令异常是由于 PC 寄存器中的原始 RAM 代码中的一条指令。这使得攻击者能够加载 RAM 中的任意地址到 PC 中，如果故障刚好被定时的话。事实证明，就是这么简单。

我们想知道为什么一个数据项会出现在程序计数器中，显然[raelize]也想知道同样的事情。有一些理论，但似乎没有人确切知道。至少，没有人不遵守保密协议。

一旦您可以任意设置 PC 地址，就很容易跳转回 UART 引导加载程序。这需要一点试验，但最终，未加密的闪存从串行端口涌出。

这是很好的工作，我们很高兴最新的硅没有显示问题。这项工作被记录在官方公告中，因此社区将知道什么是可能的。

最近出现了不少与安全相关的漏洞。通常，我们认为 ESP 工具是[黑客工具集](https://hackaday.com/2020/09/20/esp8266-turned-secretive-wifi-probe-request-sniffer/)的一部分，不是目标，但是——当然——任何东西都是公平的游戏。