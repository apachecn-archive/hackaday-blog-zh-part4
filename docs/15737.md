# 本周安全:GitHub 行动，SHA-1 退休，和自我蠕虫漏洞

> 原文:[https://hack aday . com/2022/12/23/this-week-in-security-github-actions-sha-1-retirement-and-a-self-worming-vulnerability/](https://hackaday.com/2022/12/23/this-week-in-security-github-actions-sha-1-retirement-and-a-self-worming-vulnerability/)

在 GitHub Actions 工作流中运行不受信任的代码会产生意想不到的后果，这并不奇怪。这是一个致命的特性，每当打开一个拉请求时，自动运行一个代码测试套件。但是，拉请求是在目标开发环境的某个部分运行的，这些年来发现了一些利用这一点的巧妙攻击。现在又有一个，Legit Security 称之为 Github Environment Injection(Github Environment Injection )( T1 ),一些知名组织容易受到它的攻击。

问题的关键是`$GITHUB_ENV`文件，它包含要在 Actions 环境中设置的环境变量。作为自动化操作的一部分，单个变量被添加到该文件中，并且该过程需要包括一些数据净化。否则，攻击者可以发送一个环境变量，其中包含一个换行符和完全非故意的环境变量。为了工作流的安全性，一个非故意的、任意的环境变量被玩完了。该示例使用`NODE_OPTIONS`变量将整个环境转储到可访问的输出中。任何 API 密钥或其他秘密都会被泄露。

这个特殊的攻击被报告给了 GitHub，但是没有一个实用的方法在架构上修复它。因此，在将不可信的数据写入`$GITHUB_ENV`文件时，要非常小心，这取决于各个项目。

## 你的轮胎漏气了(数据)

几年前，[迈克·梅茨格]做了一个关于 TPMS 轮胎压力监测系统的 DEFCON 演讲。这个漂亮的安全功能允许汽车轮胎中的传感器与信息娱乐中心对话，并在轮胎压力低时发出警告。[德鲁·格里斯]决定[追踪这条信息](https://medium.com/@doctoreww/day-2-your-car-is-trackable-by-law-1d5f74388850)，看看使用和滥用这些小发明有多实际。

RTL 特别提款权和非常有用的 RTL 433 项目很好地完成了这项工作。加上一根天线，信号在 50 英尺外也能看得见。当您意识到每个传感器在每次 ping 中都有一个唯一的 ID 时，事情就变得非常有趣了。需要跟踪车辆吗？跟着它的轮胎走就行了！

## 沙死了，沙万岁

NIST 已经正式宣布 SHA-1 将于 2030 年底退役，并建议尽快转移到 SHA-2 或 SHA-3。这似乎有点奇怪，因为 SHA-1 已经被认为崩溃了很长一段时间，最明显的是在 2017 年的[粉碎](https://shattered.io/)示威之后，在那里生成了两个带有匹配 SHA-1 哈希的 pdf。这种攻击的最新版本将攻击者控制两个输入的冲突的成本降低到了区区 45，000 美元。官方改革的车轮有时转得很慢。

## OpenAI，安全研究员

逆向工程的一个单调乏味的部分是处理各种函数，猜测它们的用途，并把所有东西重新命名为有用的东西。要是有一种方法能使这个过程自动化就好了。进入 [Gepetto，一个来自【伊万·科维亚特科夫斯基】](https://github.com/JusticeRage/Gepetto)的项目，它要求 OpenAI 的 Davinci-003 模型描述一个反编译函数做什么。它被打包成一个 IDA Pro 插件，但是这个概念也应该适用于其他的反编译器。第二步是将描述折叠回人工智能模型，并要求它命名函数和变量。正常的警告是适用的——人工智能聊天引擎总是会生成一个听起来不错的描述，但它可能非常不准确。

## Sovrin 和分散脆弱性

在 [CyberArk 的人们看了一眼](https://www.cyberark.com/resources/threat-research-blog/decentralized-identity-attack-surface-part-1)的分散身份(DID)景观，并在的开源 Sovrin 网络中发现了一个[极其严重的漏洞。首先，DID 试图在区块链上做一些真正有用的事情，在这个例子中是存储身份信息。想证明你的 WordPress 账号和你的 Twitter 或者 Mastodon 账号是同一个人的吗？确实能帮上忙。这个想法的版本，真正让我们的开源果汁流动是自我主权身份，一个 DID 网络，允许最终用户对自己的数据有最终控制权。尽管如此，网络仍然由运行潜在易受攻击代码的服务器组成。`POOL_UPDGRADE`命令仅限于给定池的授权管理员，但是其背后的代码使用验证然后认证的范例。](https://www.cyberark.com/resources/threat-research-blog/decentralized-identity-attack-surface-part-2)

让我们聊一会儿。操作的顺序真的很重要。我第一次真正考虑这个概念是在 Fwknop 项目中处理单个包授权的时候。这些数据包是一些请求数据，都经过加密，然后用共享密钥进行验证。哪个应该先发生？我们希望数据先被签名，然后再被加密吗？肯定不是。问题是当消息在另一端被接收时，解密过程将首先发生，对潜在的不可信数据。如果数据解析代码中存在漏洞，则可能是由未经验证的用户触发的。相反，Fwknop 项目有意地使用了先加密后认证的方法。因此，当收到传入的数据包时，第一步是检查身份验证，如果它不是来自某个已知用户，就丢弃该数据包。

回到 Sovrin，在检查授权来源之前，对传入命令的处理首先经过验证步骤。验证的一部分是查看升级命令中的包，并调用`dpkg`来验证它是一个真实的包，使用一个简单的连接来生成命令。并使用 shell 设置为 True 的`subprocess.run`。所以它很容易被分号和任何你想运行的命令所利用。更糟糕的是，升级命令会在身份验证检查之前自动通过池转发。漏洞自我蠕动的情况并不常见。这一个有当之无愧的 10.0 CVSS 分数。这个问题在 5 月份被私下披露，不到一个月后就被解决了。

## 比特和字节

奥克塔经历了艰难的一年。在今年早些时候的几次泄露之后， [Okta 的私有 GitHub 库被一名攻击者](https://www.bleepingcomputer.com/news/security/oktas-source-code-stolen-after-github-repositories-hacked/)访问并复制。到目前为止，似乎没有客户数据被访问，值得称赞的是，Okta 的安全姿态“不依赖源代码的机密性来保护其服务。”这次事件很可能是上一次入侵的后续事件，使用的是从该数据中获得的凭据。

就在我们发布之前， [Lastpass 透露了更多关于他们在 11 月遭受的攻击的信息。情况不妙。我们做出了一个有根据的猜测，原因是在之前的事件中丢失了一个访问令牌，但最新的消息表明这是一个社交工程攻击，使用了捕获的信息。丢失的数据很麻烦:包括加密的数据库、元数据，如 URL、客户姓名、地址、电话号码、IP 地址等。](https://blog.lastpass.com/2022/12/notice-of-recent-security-incident/)

值得庆幸的是，这不包括信用卡信息，Lastpass 零知识架构确实保护了实际的密码——假设您的主密码足够安全。这还不算是最坏的情况，因为没有恶意代码发送给客户，但是这已经是最坏的情况了。特别是，要警惕鱼叉式网络钓鱼和其他社会工程攻击，企图利用窃取的信息。