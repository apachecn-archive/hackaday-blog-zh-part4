# 本周安全:巴尔的摩、MacOS Zipfile 安全和应用程序商店垄断

> 原文:[https://hack aday . com/2019/05/31/this-week-in-security-Baltimore-MAC OS-zipfile-security-app-store-monopolies/](https://hackaday.com/2019/05/31/this-week-in-security-baltimore-macos-zipfile-security-app-store-monopolies/)

巴尔的摩。这座城市被攻破，遭到破坏，并被绑架勒索。勒索软件攻击于 5 月 7 日被发现，关闭了该市基础设施的主要部分。[最新消息](https://www.nytimes.com/2019/05/25/us/nsa-hacking-tool-baltimore.html?searchResultPosition=1)是 NSA 编写的工具 EternalBlue 对此次攻击负责。也许不是呢？首先，追溯一次攻击的历史是一项挑战。通常很难确定最初的攻击目标。

“初始攻击媒介”是攻击的零号患者——第一台机器是如何被入侵的。一个组织通常有一个防火墙将外部互联网与内部网络隔离开来。一旦攻击者找到了访问网络内部机器的方法，这种分离就不那么严格了。这有多种形式，但最常见的是网络钓鱼。势均力敌的竞争者是 RDP 和中小型企业(远程桌面和 Windows 文件共享)。Ars Technica 的一份[报告指出，进入巴尔的摩网络的最初媒介是一封网络钓鱼邮件。](https://arstechnica.com/information-technology/2019/05/eternally-blue-baltimore-city-leaders-blame-nsa-for-ransomware-attack/)

要考虑的第二步是所谓的“横向移动”，它描述了攻击者使用被入侵的机器来攻击组织中的其他机器。攻击者通常会有一整套利用漏洞的工具来试图危害其他机器。在这种情况下使用的一个漏洞与 NSA 工具 EternalBlue 中包含的漏洞相同。一个叫做 [psexec](http://techgenix.com/psexec-nasty-things-it-can-do/) 的聪明程序通常是任何横向运动的一部分。虽然与 EternalBlue 相关的漏洞可能被用来危害巴尔的摩网络上的一些机器，但将所有责任都推到 NSA 的肩上是没有意义的。该工具只是这次攻击的一小部分。

### Zipfiles 中的 MacOS 和 NFS 共享

MacOS 有一个有时令人恼火的功能，Gatekeeper，默认情况下只允许运行签名的二进制文件。网守的目的是防止用户运行从互联网上下载的恶意二进制文件。虽然有时这很烦人，但对一些用户来说是有帮助的。24 日，菲利普·卡瓦拉林[宣布了一个完全绕过看门人的漏洞](https://www.fcvl.net/vulnerabilities/macosx-gatekeeper-bypass)。该漏洞利用了网关守护设备认为网络共享是可信任的，并且在执行位于那里的二进制文件之前不运行正常检查的事实。虽然很有趣，但这没有用，除非攻击者有办法将一个恶意位置作为网络共享。输入 Mac 通过使用/net 路径自动挂载网络位置的能力。这个难题的最后一部分是 zip 文件可以包含符号链接。可以构建一个带有/net 位置链接的 zip 文件，自动挂载任意的 NFS 位置。如果二进制文件位于这个位置，操作系统将很乐意允许用户执行这些二进制文件，不管它们是否经过签名。

这个漏洞可能不是今年最严重的，但它仍然是一个需要解决的问题。[Filippo]早在 2 月份就联系了苹果，并披露了这个问题，甚至得到了他们将在 90 天内解决这个问题的保证。90 天过去了，苹果已经开始忽略他的电子邮件，所以他发布了公告，并在其网站上公布了复制步骤。

在本专栏的评论中有关于漏洞披露和发布概念代码证明的讨论。这是研究人员发表他们的工作的一个很好的例子。据菲利普所知，苹果无意解决他发现的问题。他也没有理由相信在他之前没有人偶然发现这个发现。我们上面提到了永恒之蓝。NSA 发现了漏洞利用针对的 SMB 漏洞，并在被盗之前默默使用了长达五年，最终向微软披露并修复。毫无疑问，公开披露和概念证明可以修复漏洞。对于任何给定的漏洞，不能保证其他人没有发现它。

### 只是一点文件泄露

好吧，也许没那么少。财富 500 强公司 First American 设法以一种可访问的格式保存了数百万份私人文档。想象你上传一个文档到一个公司，得到一个类似“test . com/documents . PHP？id = 0252234”的确认链接。如果你和我一样，你一定很好奇 at id=0252233 是什么。[Ben Shoval]是一名房地产开发商，他显然也想知道这个问题的答案。令他惊讶的是，数百万份上传的文件可供任何人查看。他试图联系第一美国，当他的电子邮件没有回应时，他将他的发现转发给了 Krebs 的安全部门。经过可能数年的曝光，该数据库终于在 24 日星期五下线。

### 围墙花园垄断

坐在苹果的火车上，应用商店显然是垄断的。终于有人问这是不是非法垄断。正如大多数这些问题一样，这将需要一场旷日持久的法庭战来决定。这是什么安全新闻？如果法院发现苹果违反了反垄断法，一个可能的补救措施是允许替代应用商店。虽然像 F-droid 这样的高质量替代商店总是有潜力的，但粗略的应用商店和下载是一种真正的可能性。另一方面，如果有一个与 GPL 兼容的 iOS 应用商店会很好。